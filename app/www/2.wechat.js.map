{"version":3,"sources":["webpack:///./client/tongji.js?b2f6","webpack:///./client/pf/wechat.js"],"names":["noop","Stat","_delayOp","_inited","key","self","loadScript","err","i","l","length","op","f","apply","p","push","me","_delay","qudao","window","cordova","o","device","platform","startup_param","pf","TDGA","Account","accountId","id","level","accountName","nickname","gameServer","accountType","gender","sex","onPageLeave","bind","n","setLevel","reason","onReward","orderid","money","tickets","desc","payment","Math","floor","onChargeRequest","orderId","iapId","currencyAmount","currencyType","virtualCurrencyAmount","paymentType","onChargeSuccess","tableid","onMissionBegin","toString","name","onItemPurchase","item","itemNumber","priceInVirtualCurrency","onMissionCompleted","onEvent","user","tabledesc","table","msg","data","tongji","onunload","userout","module","exports","require","_noop","toRuleString","rule","str","preInvite","v","opt","wechatObj","shareObj","type","title","pan","link","imgUrl","location","origin","pathname","dizhu","shareOnChat","shareOnMoment","invite","tip","Laya","stage","canvasDegree","tipon","popup","share","preShareResult","roomid","setnum","participants","winners","img","join","pay","cb","beginCharge","accWechatIntf","order","openid","r","success","res","errMsg","endCharge","wx","chooseWXPay","startRecord","stopRecord","sendRecord","localId","token","uploadVoice","isShowProgressTips","serverId","sndMap","playRecord","downloadVoice","playVoice","t","Date","_init","onVoicePlayEnd","console","log","setInterval","now","wxInit","e","tryStop","_t","clearInterval"],"mappings":"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","file":"2.wechat.js?452e50bf59171795c0f9","sourcesContent":["function noop(){}\r\n\r\nclass Stat {\r\n\tconstructor() {\r\n\t\tthis._delayOp=[];\r\n\t\tthis._inited=true;\r\n\t}\r\n\tinit(key) {\r\n\t\tthis._inited=true;\r\n\t\treturn;\r\n\t\tvar self=this;\r\n\t\tloadScript('http://sdk.talkingdata.com/g/h5/v1/'+key, function(err) {\r\n\t\t\tself._inited=true;\r\n\t\t\tfor (var i=0, l=self._delayOp.length; i<l; i++) {\r\n\t\t\t\tvar op=self._delayOp[i];\r\n\t\t\t\top.f.apply(self, op.p);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t_delay(f) {\r\n\t\tif (!this._inited) {\r\n\t\t\treturn this._delayOp.push({f:f});\r\n\t\t}\r\n\t\tf();\r\n\t}\r\n\tuserin(me) {\r\n\t\tthis._delay(function() {\r\n\t\t\tvar qudao=0;\r\n\t\t\tif (!!window.cordova) {\r\n\t\t\t\tvar o={\"Android\":1, \"BlackBerry 10\":2, \"browser\":3, \"iOS\":4,  \"WinCE\":5, \"Tizen\":6, \"Mac OS X\":7};\r\n\t\t\t\tqudao=o[device.platform]||8;\r\n\t\t\t}\r\n\t\t\telse if (startup_param.pf=='wechat') qudao=101;\r\n\t\t\tTDGA.Account({\r\n\t\t\t\taccountId : me.id,\r\n\t\t\t\tlevel : me.level,\r\n\t\t\t\taccountName:me.nickname,\r\n\t\t\t\tgameServer : '通用',\r\n\t\t\t\taccountType : qudao,\r\n\t\t\t\tgender : startup_param.sex\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\tuserout() {\r\n\t\tthis._delay(TDGA.onPageLeave.bind(TDGA));\r\n\t}\r\n\tlevelup(n) {\r\n\t\tthis._delay(TDGA.Account.setLevel.bind(TDGA.Account,n));\r\n\t}\r\n\treward(n, reason) {\r\n\t\tthis._delay(TDGA.onReward.bind(TDGA, n, reason));\r\n\t}\r\n\tbeginCharge(orderid, money, tickets, desc, payment) {\r\n\t\tif (typeof tickets=='string') {\r\n\t\t\tpayment=desc;\r\n\t\t\tdesc=tickets;\r\n\t\t\ttickets=Math.floor(money/3);\r\n\t\t}\r\n\t\tthis._delay(function() {\r\n\t\t\tTDGA.onChargeRequest({\r\n\t\t\t\torderId : orderid\r\n\t\t\t\t,iapId : desc\r\n\t\t\t\t,currencyAmount : money\r\n\t\t\t\t,currencyType : 'CNY'\r\n\t\t\t\t,virtualCurrencyAmount : tickets\r\n\t\t\t\t,paymentType:payment\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\tendCharge(orderid, payment) {\r\n\t\tthis._delay(function() {\r\n\t\t\tTDGA.onChargeSuccess({\r\n\t\t\t\torderId : orderid,\r\n\t\t\t\tpaymentType:payment\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\tenterGame(tableid) {\r\n\t\tthis._delay(function() {\r\n\t\t\tTDGA.onMissionBegin(tableid.toString());\r\n\t\t});\r\n\t}\r\n\tstartGame(tableid, name, tickets) {\r\n\t\tthis._delay(function() {\r\n\t\t\tTDGA.onItemPurchase({item:name, itemNumber:1, priceInVirtualCurrency:tickets});\r\n\t\t});\r\n\t}\r\n\tendGame(tableid) {\r\n\t\tthis._delay(function() {\r\n\t\t\tTDGA.onMissionCompleted(tableid.toString());\r\n\t\t});\t\t\r\n\t}\r\n\tshare() {\r\n\t\tthis._delay(function() {\r\n\t\t\tTDGA.onEvent('share', {user:{id:me.id, nickname:me.nickname}});\r\n\t\t});\r\n\t}\r\n\tinvite(tableid,tabledesc) {\r\n\t\tthis._delay(function() {\r\n\t\t\tTDGA.onEvent('invite', {user:{id:me.id, nickname:me.nickname}, table:{id:tableid, msg:tabledesc}});\r\n\t\t});\r\n\t}\r\n\tevent(name, data) {\r\n\t\tthis._delay(function() {\r\n\t\t\tTDGA.onEvent(name, (typeof data=='object'?data:{data:data}));\r\n\t\t});\r\n    }\r\n}\r\n\r\nvar tongji=new Stat();\r\nwindow.onunload=tongji.userout;\r\n\r\nmodule.exports=tongji;\n\n\n// WEBPACK FOOTER //\n// ./client/tongji.js","var tongji=window.tongji=require('../tongji.js');\r\nfunction _noop() {}\r\nfunction toRuleString(rule) {\r\n\tvar str='';\r\n\trule['10']&& (str+='五小牛 ');\r\n\trule['7']&& (str+='四炸牛 ');\r\n\trule['5']&& (str+='五花牛 ');\r\n\trule['4']&& (str+='四花牛 ');\r\n\tif (str.length==0) str='不带牛牛以上的牌型';\r\n\telse str='带'+str;\r\n\treturn str;\r\n}\r\nwindow.preInvite=function(v, opt) {\r\n\tif (!window.wechatObj) return;\r\n\r\n\tvar shareObj={\r\n\t\ttype: 'link',\r\n\t\ttitle: '牛牛大作战，房号:'+v+'('+opt.pan+'局)',\r\n\t\tlink: 'http://a.mlinks.cc/AaIu?room='+v,\r\n\t\t//link:'http://h5.1357g.com/wnn/res244.jpg',\r\n\t\timgUrl: location.origin+location.pathname+'res/logo.png',\r\n\t\t//dataUrl:'http://h5.1357g.com/wnn/res244.jpg',\r\n\t\tdesc: '轮庄，'+toRuleString(opt.rule)+', '+opt.dizhu+'底！',\r\n\t\t//success: function (){},\r\n\t\t//cancel: function (){}\r\n\t};\r\n\twindow.wechatObj.shareOnChat(shareObj);\r\n\twindow.wechatObj.shareOnMoment(shareObj);\r\n\r\n\twindow.invite=function() {\r\n\t\tvar tip='点击'+(Laya.stage.canvasDegree==0?'右':'左')+'上角分享按钮，邀请好友加入游戏';\r\n\t\ttipon(tip).popup();\r\n\t\ttongji.invite(v, '轮庄，'+toRuleString(opt.rule)+', '+opt.dizhu+'底！');\r\n\t}\r\n}\r\nwindow.invite=function() {\r\n\tvar tip='点击'+(Laya.stage.canvasDegree==0?'右':'左')+'上角分享按钮，邀请好友加入游戏';\r\n\ttipon(tip).popup();\r\n}\r\nwindow.share=function() {\r\n\tvar tip='点击'+(Laya.stage.canvasDegree==0?'右':'左')+'上角分享按钮，分享到朋友圈';\r\n\ttipon(tip).popup();\r\n\ttongji.share();\r\n}\r\nwindow.preShareResult=function(roomid, setnum, participants, winners, img) {\r\n\tvar shareObj={\r\n\t\ttype: 'link',\r\n\t\ttitle: '牛牛大作战，房号:'+roomid+(setnum!=null?(', 第'+setnum+'局'):''),\r\n\t\tlink: img,\r\n\t\t//link:'http://h5.1357g.com/wnn/res244.jpg',\r\n\t\timgUrl: img,\r\n\t\t//dataUrl:'http://h5.1357g.com/wnn/res244.jpg',\r\n\t\tdesc: (participants||[]).join(',')+' 胜利者 '+(winners||[]).join(','),\r\n\t\t//success: function (){},\r\n\t\t//cancel: function (){}\t\t\r\n\t}\r\n\twindow.wechatObj.shareOnChat(shareObj);\r\n\twindow.wechatObj.shareOnMoment(shareObj);\r\n}\r\nwindow.pay=function(orderid, money, desc, cb) {\r\n\t!cb && (cb=_noop);\r\n\ttongji.beginCharge(orderid, money, desc, '微信公众号支付');\r\n\taccWechatIntf('/weixin/getWechatpayParams',{order:orderid, money:money, openid:startup_param.openid}, function(err, r) {\r\n\t\tif (err || r.err) return tipon(err||r.err).popup();\r\n\t\tr.success=function(res) {\r\n\t\t\tif(res.errMsg == \"chooseWXPay:ok\"){\r\n\t\t\t\ttongji.endCharge(orderid, '微信公众号支付');\r\n\t\t\t\tcb(null, true);\r\n\t\t\t}else{\r\n\t\t\t\tcb(null, false);\r\n\t\t\t}\r\n\t\t}\r\n\t\twx.chooseWXPay(r);\r\n\t})\r\n}\r\nwindow.startRecord=function() {\r\n\twx.startRecord();\r\n}\r\nwindow.stopRecord=function(cb) {\r\n\twx.stopRecord({\r\n\t\tsuccess: function (res) {\r\n\t\t\tcb && window.sendRecord(res.localId, cb);\r\n\t\t}\r\n\t});\r\n}\r\nwindow.sendRecord=function(token, cb) {\r\n\twx.uploadVoice({\r\n\t\tlocalId: token, // 需要上传的音频的本地ID，由stopRecord接口获得\r\n\t\tisShowProgressTips: 0, // 默认为1，显示进度提示\r\n\t\tsuccess: function (res) {\r\n\t\t\tvar serverId = res.serverId; // 返回音频的服务器端ID\r\n\t\t\tcb(null, serverId);\r\n\t\t}\r\n\t});\r\n}\r\nvar sndMap={};\r\nwindow.playRecord=function(token, cb) {\r\n\twx.downloadVoice({\r\n\t\tserverId: token, // 需要下载的音频的服务器端ID，由uploadVoice接口获得\r\n\t\tisShowProgressTips: 0, // 默认为1，显示进度提示\r\n\t\tsuccess: function (res) {\r\n\t\t\tvar localId = res.localId; // 返回音频的本地ID\r\n\t\t\twx.playVoice({localId:localId});\r\n\t\t\tsndMap[localId]={cb:cb, t:new Date()};\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction _init() {\r\n\twx.onVoicePlayEnd({\r\n\t\tsuccess: function (res) {\r\n\t\t\tvar o=sndMap[res.localId];\r\n\t\t\tconsole.log(res);\r\n\t\t\tif (typeof o.cb==='function') {\r\n\t\t\t\to.cb();\r\n\t\t\t\tdelete sndMap[res.localId];\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tsetInterval(function() {\r\n\t\tvar now=new Date();\r\n\t\tfor (var i in sndMap) {\r\n\t\t\tvar o=sndMap[i];\r\n\t\t\tif (now-o.t>=3000) {\r\n\t\t\t\to.cb && o.cb();\r\n\t\t\t\tdelete sndMap[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}, 3000);\r\n}\r\n\r\nwindow.wxInit=function() {\r\n\tvar shareObj={\r\n\t\t\ttype: 'link',\r\n\t\t\ttitle: '牛牛大作战，大家来斗牛',\r\n\t\t\tlink: location.origin+location.pathname,\r\n\t\t\timgUrl: location.origin+location.pathname+'res/logo.png',\r\n\t\t\tdesc: ''\r\n\t\t\t//success: function (){},\r\n\t\t\t//cancel: function (){}\t\t\r\n\t\t};\r\n\ttry {\r\n\t\twindow.wechatObj.shareOnChat(shareObj);\r\n\t\twindow.wechatObj.shareOnMoment(shareObj);\r\n\t} catch(e) {\r\n\t\tconsole.log(e);\r\n\t}\r\n\r\n\twx.startRecord();\r\n\tfunction tryStop() {\r\n\t\tvar _t=setInterval(function() {\r\n\t\t\twx.stopRecord({\r\n\t\t\t\tsuccess: function (res) {\r\n\t\t\t\t\tclearInterval(_t);\t\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}, 300);\r\n\t}\r\n\ttryStop();\r\n\r\n\t_init();\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./client/pf/wechat.js"],"sourceRoot":""}