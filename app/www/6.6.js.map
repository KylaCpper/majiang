{"version":3,"sources":["webpack:///./client/majiang.js","webpack:///./client/embedani.js","webpack:///./client/cardImg.js","webpack:///./client/rule.js","webpack:///./client/waitableEvent.js","webpack:///./client/res/snd/bgm2.mp3","webpack:///./client/safePeer.js","webpack:///./client/libs/peer.js"],"names":["Loader","laya","net","Handler","utils","wins","require","async","merge","EventEmitter","me","ani","cardImg","parseR","WaitableEvent","MenuInst","Mj","opt","self","_spec","c","halted","msgloop","window","_socket","sendp","netmsg","once","msg","inviteCode","v","preInvite","Laya","SoundManager","playMusic","mySeat","activeVideo","cardList","handCards","sort","str","i","length","mjMap","_view","getChild","text","console","log","showCards","pos","left","right","dui","cardInfo","throwCards","time","remainTime","cdTimer","setInterval","updateTime","bind","clearInterval","removeChildren","daPaiBtn","fairygui","UIPackage","createObject","asCom","addChild","setTimeout","removeChild","onClick","index","parseInt","Math","floor","random","throwCard","Array","isArray","key","chiChoose","chiBtn","k","ans","choose","pengBtn","gangBtn","huBtn","pack","waitE","emit","initCardInfo","updateThrowCards","updateShowCards","anGang","actionCard","roomInfo","initTime","over","usevideo","usertc","cordova","location","search","indexOf","SafePeer","callUser","id","peer","call","localStream","metadata","err","stream","on","step3","refresh","gd","seats","s","user","offline","_calls","to","subc","Connection","navigator","connection","type","WIFI","ETHERNET","confirm","tipon","popup","getUserMedia","webkitGetUserMedia","mozGetUserMedia","_call","close","video","sysdiv","cb","parallel","loader","load","url","BUFFER","create","Flash2x","loadScene","room","addPackage","roomview","module","exports","F2xExtend","__extends","aniDiv","$","append","stage","annie","Stage","StageScaleMode","SHOW_ALL","autoSteering","playStarting","onend","f2x","show","RootScene","hide","playWin","win","cardv","cardType","def","mkall","map","hua","pai","cv","ov","permutator","inputArr","results","permute","arr","memo","cur","splice","push","concat","slice","t","toLowerCase","Number","reverseCardType","reverseCardValue","niuValue","r","_t","mc","fixv","isXiaoniuniu","total","calcR","fv","j","o","allp","maxr","f","op","waitEvent","delayAll","_opt","_e","_delay","cmds","apply","arguments","chkDelay","_id","_delayOp","_start","_peer","Peer","l","message","destory","retry","disconnected"],"mappings":"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A8C;;AAE9C;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,gCAA+B,WAAW;AAC1C;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAO;AACP,MAAK;AACL;AACA;AACA;AACA;AACA,QAAO;AACP,MAAK;AACL;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,qCAAoC,QAAQ;AAC5C;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC,EAAE,4DAA4D;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,EAAC,EAAE,gIAAgI;AACnI;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,gCAA+B;;AAE/B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA,qCAAoC;;AAEpC;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,QAAQ;AAC/C;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC,EAAE,8CAA8C;AACjD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,aAAY;AACZ;AACA,IAAG,cAAc,SAAS,WAAW;AACrC,kBAAiB;AACjB;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAkB;AAClB,QAAO;AACP;AACA;AACA,mBAAkB;AAClB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,qCAAoC,QAAQ;AAC5C;AACA;AACA,eAAc;AACd;AACA;AACA,IAAG;AACH,oBAAmB;AACnB;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,IAAG;AACH;AACA;AACA,EAAC;;;AAGD;AACA;AACA;;AAEA;AACA;;AAEA;AACA,iBAAgB,YAAY,sBAAsB;AAClD,IAAG;AACH;AACA,iBAAgB,YAAY,2BAA2B;AACvD;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,QAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,QAAO;AACP,MAAK;AACL;AACA;AACA,MAAK;AACL,IAAG;AACH;AACA;AACA,IAAG;AACH;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,QAAO;AACP,MAAK;AACL;AACA;AACA,MAAK;AACL,IAAG;AACH;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;;AAEA,EAAC,EAAE,yBAAyB;AAC5B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,0BAAyB;AACzB,6BAA4B;AAC5B,qBAAoB;AACpB;;AAEA;AACA,yBAAwB;AACxB,2BAA0B;AAC1B;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,8CAA6C,QAAQ;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA0C,QAAQ;AAClD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,uCAAsC,QAAQ;AAC9C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,2CAA0C,QAAQ;AAClD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC,EAAE,qFAAqF;AACxF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,4CAA2C;AAC3C;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,2CAA0C,QAAQ;AAClD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC,EAAE,6BAA6B;AAChC,sBAAqB,gBAAgB,wCAAwC;AAC7E;;AAEA;AACA;;AAEA;AACA,sBAAqB;;AAErB;AACA;;AAEA;AACA,qBAAoB,YAAY;AAChC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,qCAAoC,OAAO;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,kDAAiD,YAAY,sBAAsB,EAAE;AACrF,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;;AAEA;AACA;AACA;AACA,+DAA8D;AAC9D;AACA,gFAA+E;AAC/E;AACA,QAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,iEAAgE,YAAY,sBAAsB,EAAE;AACpG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,QAAO;AACP;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mCAAkC;AAClC,qCAAoC;AACpC;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA,IAAG;;;AAGH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,uCAAsC,OAAO;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA,IAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,oBAAmB,mBAAmB;AACtC;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,EAAC,EAAE,iCAAiC;AACpC;;AAEA;AACA;AACA;AACA,YAAW,SAAS;AACpB,YAAW,MAAM;AACjB,YAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB;;AAEzB;AACA;AACA;AACA,WAAU;AACV;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,cAAa;AACb;AACA;AACA;AACA;;AAEA,2DAA0D,OAAO;AACjE;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,cAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,0CAAyC,SAAS;AAClD;AACA;;AAEA;AACA,IAAG;AACH,gBAAe,YAAY;AAC3B;;AAEA;AACA,4DAA2D;AAC3D,gEAA+D;AAC/D,oEAAmE;AACnE;AACA,2DAA0D,SAAS;AACnE;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,QAAQ;AACnB,YAAW,MAAM;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,SAAS;AACpB,YAAW,MAAM;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,SAAS;AACpB,YAAW,QAAQ;AACnB;AACA;AACA;AACA;;AAEA;AACA;;AAEA,qDAAoD,YAAY;AAChE;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,EAAC,GAAG;AACJ;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,iBAAgB,WAAW;AAC3B;AACA;AACA;AACA;;AAEA;AACA;AACA,iBAAgB,WAAW;AAC3B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;AACH;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;AACH;AACA,IAAG;AACH;AACA;AACA,MAAK;AACL;AACA;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,UAAS;AACT;AACA;AACA,QAAO;AACP;AACA;AACA,UAAS;AACT;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA,iBAAgB,aAAa;AAC7B;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA,EAAC,EAAE,qBAAqB;AACxB;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,4CAA2C,QAAQ;AACnD;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;;AAEA,EAAC,GAAG;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,WAAU;AACV;AACA,WAAU;AACV;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,uCAAsC,QAAQ;AAC9C;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,2CAA0C,QAAQ;AAClD;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,sCAAqC,QAAQ;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAwB,WAAW;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAkC;AAClC;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA,EAAC,EAAE,YAAY;AACf;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA,sBAAqB,sBAAsB;AAC3C;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,M;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,oBAAmB,mBAAmB;AACtC;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;;AAEA;;AAEA,EAAC,EAAE,mBAAmB,EAAE,GAAG","file":"6.6.js?3b51c5c96c39ea6cb6fa","sourcesContent":["'use strict';\r\n\r\nvar Loader = laya.net.Loader;\r\nvar Handler = laya.utils.Handler;\r\n\r\nvar wins=require('./windows.js');\r\nvar async=require('async'), merge=require('merge'), EventEmitter=require('events');\r\nvar me=require('./myself.js'), ani=require('./embedani.js');\r\nvar cardImg=require('./cardImg.js');\r\nvar parseR=require('./rule.js').parseR;\r\nvar WaitableEvent=require('./waitableEvent.js');\r\n\r\nvar MenuInst=null;\r\n\r\nclass Mj {\r\n\tconstructor(opt) {\r\n\t\tvar self=this;\r\n\t\tthis.opt=opt;\r\n\t\tthis._spec={c:[], halted:false};\r\n\t\tvar self=this;\r\n\t\tthis.msgloop=window.msgloop;\r\n\t}\r\n\t\r\n\tstatic create(opt, cb) {\r\n\t\tif (typeof opt==='function') {cb=opt; opt={}}\r\n\t\tasync.parallel([\r\n\t\t\tfunction(cb) {\r\n\t\t\t\tLaya.loader.load([\r\n\t\t\t\t\t{ url: require(\"./res/majiang.fui\"), type: Loader.BUFFER }\r\n\t\t\t\t], Handler.create(null, function() {cb();}))\r\n\t\t\t},\r\n\t\t\tfunction(cb) {Flash2x.loadScene(\"f2x\",function(){}, function(){\r\n\t\t\t\tFlash2x.loadScene(\"win\",function(){}, function(){cb()});\r\n\t\t\t})}\r\n\t\t],function(err) {\r\n\t\t\tvar room=new Mj(opt);\r\n\t\t\tfairygui.UIPackage.addPackage('majiang');\r\n\t\t\tvar _view =room._view= fairygui.UIPackage.createObject(\"majiang\", \"Component1\").asCom;\r\n\t\t\twindow.roomview=_view;\r\n            room.mjMap = {\r\n                101:\"一万\",102:\"二万\",103:\"三万\",104:\"四万\",105:\"五万\",106:\"六万\",107:\"七万\",108:\"八万\",109:\"九万\",  \r\n                201:\"一饼\",202:\"二饼\",203:\"三饼\",204:\"四饼\",205:\"五饼\",206:\"六饼\",207:\"七饼\",208:\"八饼\",209:\"九饼\",  \r\n                301:\"一条\",302:\"二条\",303:\"三条\",304:\"四条\",305:\"五条\",306:\"六条\",307:\"七条\",308:\"八条\",309:\"九条\",  \r\n                401:\"东风\",402:\"西风\",403:\"南风\",404:\"北风\",405:\"红中\",406:\"发财\",407:\"白板\",\r\n                501:\"春\",502:\"夏\",503:\"秋\",504:\"冬\",505:\"梅\",506:\"兰\",507:\"竹\",508:\"菊\"\r\n            };\r\n            room.pos;\r\n            room.handCards;\r\n            room.remainTime = 0;\r\n            _view.getChild('n18').onClick(null,function() {\r\n                _socket.sendp({c:'gamestart'});\r\n            });\r\n            _socket.sendp({c:'roomInfo'});\r\n\t\t\tcb(null, room);\r\n\t\t});\r\n\t}\r\n\tactive() {\r\n\t\tvar self=this;\r\n\t\t_socket.sendp({c:'createInviteCode'});\r\n\t\tnetmsg.once('inviteCode', null, function(msg) {\r\n\t\t\tself.inviteCode=msg.v;\r\n\t\t\twindow.preInvite && window.preInvite(msg.v, self.opt);\r\n\t\t});\r\n\t\tLaya.SoundManager.playMusic(require('./res/snd/bgm2.mp3'));\r\n\t\tthis.mySeat=null;\r\n\t\tthis.activeVideo();\r\n\t}\r\n\tdeactive() {\r\n       \r\n\t}\r\n\r\n    initCardInfo(cardList) {\r\n        this.handCards = cardList;\r\n        this.handCards.sort();\r\n        var str = '';\r\n        for (var i = 0;i<this.handCards.length;i++) {\r\n            str = str + (i+1) + '_' + this.mjMap[this.handCards[i]] + ',';\r\n        }\r\n        this._view.getChild('n0').text = str;\r\n        console.log(str);\r\n    }\r\n\r\n    updateShowCards(showCards,pos) {\r\n        console.log('this.pos === ' + this.pos);\r\n        var left = this.pos - 1 < 0?3:this.pos - 1;\r\n        var right = this.pos + 1 > 3?0:this.pos + 1;\r\n        var dui = this.pos + 2 > 3?this.pos - 2:this.pos + 2;\r\n        var str = '';\r\n        if (this.pos == pos) {\r\n            for (var i = 0;i<showCards.length;i++) {\r\n                str = str + this.mjMap[showCards[i]] + ',';\r\n            }\r\n            this._view.getChild('n21').text = this._view.getChild('n21').text + '' + str;\r\n        } else if (left == pos) {\r\n            for (var i = 0;i<showCards.length;i++) {\r\n                str = str + this.mjMap[showCards[i]] + ',';\r\n            }\r\n            this._view.getChild('n1').text = str;\r\n        } else if (right == pos) {\r\n            for (var i = 0;i<showCards.length;i++) {\r\n                str = str + this.mjMap[showCards[i]] + ',';\r\n            }\r\n            this._view.getChild('n3').text = str;\r\n        } else if (dui == pos) {\r\n            for (var i = 0;i<showCards.length;i++) {\r\n                str = str + this.mjMap[showCards[i]] + ',';\r\n            }\r\n            this._view.getChild('n25').text = str;\r\n        }\r\n    }\r\n\r\n    anGang(cardInfo) {\r\n        var str = '';\r\n        for (var i = 0;i<4;i++) {\r\n            str = str + this.mjMap[cardInfo] + ',';\r\n        }\r\n        this._view.getChild('n21').text = this._view.getChild('n21').text + '' + str;\r\n    }\r\n\r\n    updateThrowCards(throwCards,pos) {\r\n        console.log('this.pos === ' + this.pos);\r\n        var left = this.pos - 1 < 0?3:this.pos - 1;\r\n        var right = this.pos + 1 > 3?0:this.pos + 1;\r\n        var dui = this.pos + 2 > 3?this.pos - 2:this.pos + 2;\r\n        var str = '';\r\n        if (this.pos == pos) {\r\n            for (var i = 0;i<throwCards.length;i++) {\r\n                str = str + this.mjMap[throwCards[i]] + ',';\r\n            }\r\n            this._view.getChild('n23').text = str;\r\n        } else if (left == pos) {\r\n            for (var i = 0;i<throwCards.length;i++) {\r\n                str = str + this.mjMap[throwCards[i]] + ',';\r\n            }\r\n            this._view.getChild('n2').text = str;\r\n        } else if (right == pos) {\r\n            for (var i = 0;i<throwCards.length;i++) {\r\n                str = str + this.mjMap[throwCards[i]] + ',';\r\n            }\r\n            this._view.getChild('n24').text = str;\r\n        } else if (dui == pos) {\r\n            for (var i = 0;i<throwCards.length;i++) {\r\n                str = str + this.mjMap[throwCards[i]] + ',';\r\n            }\r\n            this._view.getChild('n26').text = str;\r\n        }\r\n    }\r\n\r\n    roomInfo(pos) {\r\n        console.log('pos .......');\r\n        this.pos = pos;\r\n        this._view.getChild('n39').text = this.pos;\r\n        console.log('pos ====' + this.pos);\r\n    }\r\n\r\n    initTime(time,pos) {\r\n\t\tvar self = this;\r\n        this._view.getChild('n41').text = pos;\r\n\t\tself.remainTime = time/1000;\r\n\t\tself._view.getChild('n34').text = self.remainTime + 'S';\r\n\t\tif (self.cdTimer == null) {\r\n\t\t\tself.cdTimer=setInterval(self.updateTime.bind(this),1000);\r\n\t\t}\r\n\t}\r\n\r\n    over() {\r\n        this._view.getChild('n42').text = '游戏结束！';\r\n    }\r\n\r\n    updateTime() {\r\n\t\tvar self = this;\r\n\t\tif (self.remainTime <= 0) {\r\n\t\t\tself._view.getChild('n34').text = '0S';\r\n\t\t\tclearInterval(self.cdTimer);\r\n\t\t\tself.cdTimer = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tself.remainTime -= 1;\r\n\t\tself._view.getChild('n34').text = self.remainTime + 'S';\r\n\t}\r\n\r\n    actionCard(v) {\r\n         var self = this;\r\n        //轮到打牌\r\n        if (v.v == 0) {\r\n            this._view.getChild('n17').removeChildren();\r\n            var daPaiBtn = fairygui.UIPackage.createObject('majiang','打牌').asCom;\r\n            this._view.getChild('n17').addChild(daPaiBtn);\r\n\r\n            setTimeout(function() {\r\n                self._view.getChild('n17').removeChild(daPaiBtn);\r\n                daPaiBtn = null;\r\n            }, 10*1000);\r\n\r\n            daPaiBtn.onClick(null,function() {\r\n                var index;\r\n                if (self._view.getChild('n32').getChild('n34').text) {\r\n                   index = (parseInt(self._view.getChild('n32').getChild('n34').text) - 1) < 0?0:(parseInt(self._view.getChild('n32').getChild('n34').text) - 1);\r\n                   self._view.getChild('n32').getChild('n34').text = '';\r\n                } else {\r\n                    index = Math.floor(Math.random()*self.handCards.length);\r\n                }\r\n                var throwCard = self.handCards[index];\r\n                console.log('throwCard = ' + throwCard);\r\n                _socket.sendp({c:'table.ans',cardInfo:throwCard});\r\n                self._view.getChild('n17').removeChild(daPaiBtn);\r\n                daPaiBtn = null;\r\n            });\r\n        }\r\n        //响应对应牌的操作 吃碰杠胡 1234 5碰的牌能杠\r\n        else if (Array.isArray(v.v)&&v.v.length > 0) {\r\n            this._view.getChild('n17').removeChildren();\r\n            for (var i=0;i<v.v.length;i++) {\r\n                if (v.v[i] == 1) {\r\n                    for (var key in v.chiChoose) {\r\n                        var chiBtn = fairygui.UIPackage.createObject('majiang','吃').asCom;\r\n                        this._view.getChild('n17').addChild(chiBtn);\r\n\r\n                        setTimeout(function() {\r\n                            self._view.getChild('n17').removeChild(chiBtn);\r\n                            chiBtn = null;\r\n                        }, 10*1000);\r\n\r\n                        chiBtn.onClick(null,function() {\r\n                            var k = key;\r\n                            _socket.sendp({c:'table.ans',ans:1,choose:k});\r\n                            self._view.getChild('n17').removeChild(chiBtn);\r\n                            chiBtn = null;\r\n                        });\r\n                    }\r\n                }\r\n                if (v.v[i] == 2) {\r\n                    var pengBtn = fairygui.UIPackage.createObject('majiang','碰').asCom;\r\n                    this._view.getChild('n17').addChild(pengBtn);\r\n\r\n                    setTimeout(function() {\r\n                        self._view.getChild('n17').removeChild(pengBtn);\r\n                        pengBtn = null;\r\n                    }, 10*1000);\r\n\r\n                    pengBtn.onClick(null,function() {\r\n                        _socket.sendp({c:'table.ans',ans:2});\r\n                        self._view.getChild('n17').removeChild(pengBtn);\r\n                        pengBtn = null;\r\n                    });\r\n                }\r\n                if (v.v[i] == 3) {\r\n                    var gangBtn = fairygui.UIPackage.createObject('majiang','杠').asCom;\r\n                    this._view.getChild('n17').addChild(gangBtn);\r\n\r\n                    setTimeout(function() {\r\n                        self._view.getChild('n17').removeChild(gangBtn);\r\n                        gangBtn = null;\r\n                    }, 10*1000);\r\n\r\n                    gangBtn.onClick(null,function() {\r\n                        _socket.sendp({c:'table.ans',ans:3});\r\n                        self._view.getChild('n17').removeChild(gangBtn);\r\n                        gangBtn = null;\r\n                    });\r\n                }\r\n                if (v.v[i] == 4) {\r\n                    var huBtn = fairygui.UIPackage.createObject('majiang','胡').asCom;\r\n                    this._view.getChild('n17').addChild(huBtn);\r\n\r\n                    setTimeout(function() {\r\n                        self._view.getChild('n17').removeChild(huBtn);\r\n                        huBtn = null;\r\n                    }, 10*1000);\r\n\r\n                    huBtn.onClick(null,function() {\r\n                        _socket.sendp({c:'table.ans',ans:4});\r\n                        self._view.getChild('n17').removeChild(huBtn);\r\n                        huBtn = null;\r\n                    });\r\n                }\r\n                if (v.v[i] == 5) {\r\n                    var gangBtn = fairygui.UIPackage.createObject('majiang','杠').asCom;\r\n                    this._view.getChild('n17').addChild(gangBtn);\r\n\r\n                    setTimeout(function() {\r\n                        self._view.getChild('n17').removeChild(gangBtn);\r\n                        gangBtn = null;\r\n                    }, 5*1000);\r\n\r\n                    gangBtn.onClick(null,function() {\r\n                        _socket.sendp({c:'table.ans',ans:5});\r\n                        self._view.getChild('n17').removeChild(gangBtn);\r\n                        gangBtn = null;\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }\r\n\t\r\n\tmsg(pack) {\r\n\t\tvar self=this;\r\n\t\tswitch(pack.c) {\r\n\t\t\tcase 'table.userin':\r\n\t\t\t\tself.waitE.emit('table.userin', pack);\r\n\t\t\tbreak;\r\n\t\t\tcase 'table.userout':\r\n\t\t\t\tself.waitE.emit('table.userout', pack);\t\t\t\r\n\t\t\tbreak;\r\n            case 'cardInfo':\r\n                self.initCardInfo(pack.handCards);\r\n            break;\r\n            case 'updateThrowCards':\r\n                self.updateThrowCards(pack.throwCards,pack.pos);\r\n            break;\r\n            case 'updateShowCards':\r\n                self.updateShowCards(pack.showCards,pack.pos);\r\n            break;\r\n            case 'anGang':\r\n                self.anGang(pack.cardInfo);\r\n            break;\r\n            case 'table.ask':\r\n                self.actionCard(pack.v);\r\n            break;\r\n            case 'roomInfo':\r\n                self.roomInfo(pack.pos);\r\n            break;\r\n            case 'updateTime':\r\n                self.initTime(pack.time,pack.pos);\r\n            break;\r\n            case 'over':\r\n                self.over();\r\n            break;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\tactiveVideo() {\r\n\t\tvar self=this;\r\n\t\tvar usevideo=false, usertc=false;\r\n\t\tthis.waitE=new WaitableEvent('open');\r\n\t\tif (!!window.cordova || location.search.indexOf('usepeer')>=0) {\r\n\t\t\tif (!!window.Connection) {\r\n\t\t\t\tif (navigator.connection.type!=Connection.WIFI && navigator.connection.type!=Connection.ETHERNET) {\r\n\t\t\t\t\tif (!confirm('在手机网络下使用视频可能产生高额流量费用，是否关闭视频？')) {\r\n\t\t\t\t\t\tusevideo=true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}else usevideo=true;\r\n\t\t\t\tusertc=true;\r\n\t\t\t}\r\n\t\t\telse usevideo=true;\r\n\t\t\tif (!usevideo) tipon('实时语音已经启动，说句话试试吧').popup();\r\n\t\t\tvar SafePeer=require('./safePeer.js');\r\n\t\t\tthis._calls={};\r\n\t\t\tnavigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\r\n\r\n\t\t\tself.waitE.on('trans', function(pack) {\r\n\t\t\t\tif (pack.subc!='peerready') return;\r\n\t\t\t\tconsole.log('table.peerready, chk need call', pack);\r\n\t\t\t\tif (pack.id>me.id) {\r\n\t\t\t\t\tconsole.log('call', pack.id);\r\n\t\t\t\t\tself.peer.call(pack.id, window.localStream, {metadata:me.id}, function(err, stream) {\r\n\t\t\t\t\t\tstep3(pack.id, stream);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.on('table.userout', function(pack) {\r\n\t\t\t\tconsole.log(self._calls);\r\n\t\t\t\tvar _call=self._calls[pack.id];\r\n\t\t\t\tif (_call) {\r\n\t\t\t\t\tconsole.log('call off', pack.id);\r\n\t\t\t\t\t_call.call && _call.call.close();\r\n\t\t\t\t\t_call.video && sysdiv.removeChild(_call.video);\r\n\t\t\t\t\tdelete self._calls[pack.id];\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tfunction callUser(id) {\r\n\t\t\t\tconsole.log('call', id);\r\n\t\t\t\tself.peer.call(id, window.localStream, {metadata:me.id}, function(err, stream) {\r\n\t\t\t\t\tstream.on('error', function() {\r\n\t\t\t\t\t\tcallUser(id);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tstep3(id, stream);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tfunction refresh() {\r\n\t\t\t\tif (gd.seats) {\r\n\t\t\t\t\tfor (var i=0; i<gd.seats.length; i++) {\r\n\t\t\t\t\t\tvar s=gd.seats[i];\r\n\t\t\t\t\t\tif (!s) continue;\r\n\t\t\t\t\t\tif (s.user.id>me.id && (!s.user.offline) && self._calls[s.user.id]==null) {\r\n\t\t\t\t\t\t\tcallUser(s.user.id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (s.user.id<me.id) {\r\n\t\t\t\t\t\t\t_socket.sendp({c:'trans', to:s.user.id, subc:'peerready', id:me.id});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n}\r\n\r\nmodule.exports=Mj.create;\n\n\n// WEBPACK FOOTER //\n// ./client/majiang.js","window.F2xExtend=__extends;\r\n\r\nvar aniDiv=$('<div id=\"annie\" style=\"position:absolute; left=0px; top:0px;display:none\"/>');\r\n$('body').append(aniDiv);\r\nvar stage=new annie.Stage(\"annie\",640,360,24,annie.StageScaleMode.SHOW_ALL,0);\r\nstage.autoSteering=true;\r\n\r\nfunction playStarting(onend) {\r\n\tif (!f2x) return onend('ani starting is not defined');\r\n\taniDiv.show();\r\n\tstage.addChild(new f2x.RootScene(function() {\r\n\t\taniDiv.hide();\r\n\t\tif (typeof onend=='function') onend();\r\n\t}));\r\n}\r\n\r\nfunction playWin(onend) {\r\n\tif (!f2x) return onend('ani win is not defined');\r\n\taniDiv.show();\r\n\tstage.addChild(new win.RootScene(function() {\r\n\t\taniDiv.hide();\r\n\t\tif (typeof onend=='function') onend();\r\n\t}));\t\r\n}\r\n\r\nmodule.exports={\r\n\tplayStarting:playStarting,\r\n\tplayWin:playWin\r\n}\n\n\n// WEBPACK FOOTER //\n// ./client/embedani.js","var cardv=require('./rule.js').cardv;\r\nvar cardType={'黑桃':3, '红桃':2, '梅花':1, '方块':0, 'heitao':3, 'hongtao':2, 'meihua':1, 'fangkuai':0};\r\nvar def={\r\n\t'黑桃':{\r\n\t\t'A':'ui://6f69ijynohzxpq',\r\n\t\t'2':'ui://6f69ijynohzxps',\r\n\t\t'3':'ui://6f69ijynohzxpt',\r\n\t\t'4':'ui://6f69ijynohzxpu',\r\n\t\t'5':'ui://6f69ijynohzxpv',\r\n\t\t'6':'ui://6f69ijynohzxpi',\r\n\t\t'7':'ui://6f69ijynohzxpj',\r\n\t\t'8':'ui://6f69ijynohzxpk',\r\n\t\t'9':'ui://6f69ijynohzxpl',\r\n\t\t'10':'ui://6f69ijynohzxpm',\r\n\t\t'J':'ui://6f69ijynohzxpn',\r\n\t\t'Q':'ui://6f69ijynohzxpo',\r\n\t\t'K':'ui://6f69ijynohzxpp'\r\n\t},\r\n\t'红桃':{\r\n\t\t'A':'ui://6f69ijynohzxpa',\r\n\t\t'2':'ui://6f69ijynohzxpc',\r\n\t\t'3':'ui://6f69ijynohzxpd',\r\n\t\t'4':'ui://6f69ijynohzxpe',\r\n\t\t'5':'ui://6f69ijynohzxpf',\r\n\t\t'6':'ui://6f69ijynohzxp2',\r\n\t\t'7':'ui://6f69ijynohzxp3',\r\n\t\t'8':'ui://6f69ijynohzxp4',\r\n\t\t'9':'ui://6f69ijynohzxp5',\r\n\t\t'10':'ui://6f69ijynohzxp6',\r\n\t\t'J':'ui://6f69ijynohzxp7',\r\n\t\t'Q':'ui://6f69ijynohzxp8',\r\n\t\t'K':'ui://6f69ijynohzxp9'\r\n\t},\r\n\t'梅花':{\r\n\t\t'A':'ui://6f69ijynohzxov',\r\n\t\t'2':'ui://6f69ijynohzxox',\r\n\t\t'3':'ui://6f69ijynohzxoy',\r\n\t\t'4':'ui://6f69ijynohzxoz',\r\n\t\t'5':'ui://6f69ijynohzxp0',\r\n\t\t'6':'ui://6f69ijynohzxon',\r\n\t\t'7':'ui://6f69ijynohzxoo',\r\n\t\t'8':'ui://6f69ijynohzxop',\r\n\t\t'9':'ui://6f69ijynohzxoq',\r\n\t\t'10':'ui://6f69ijynohzxor',\r\n\t\t'J':'ui://6f69ijynohzxos',\r\n\t\t'Q':'ui://6f69ijynohzxot',\r\n\t\t'K':'ui://6f69ijynohzxou'\r\n\t},\r\n\t'方块':{\r\n\t\t'A':'ui://6f69ijynohzxoc',\r\n\t\t'2':'ui://6f69ijynohzxoe',\r\n\t\t'3':'ui://6f69ijynohzxof',\r\n\t\t'4':'ui://6f69ijynohzxog',\r\n\t\t'5':'ui://6f69ijynohzxoh',\r\n\t\t'6':'ui://6f69ijynohzxoi',\r\n\t\t'7':'ui://6f69ijynohzxoj',\r\n\t\t'8':'ui://6f69ijynohzxok',\r\n\t\t'9':'ui://6f69ijynohzxol',\r\n\t\t'10':'ui://6f69ijynohzxo8',\r\n\t\t'J':'ui://6f69ijynohzxo9',\r\n\t\t'Q':'ui://6f69ijynohzxoa',\r\n\t\t'K':'ui://6f69ijynohzxob'\r\n\t},\r\n};\r\n\r\n(function mkall() {\r\n\tvar map=def['map']=[];\r\n\tfor (var hua in def) {\r\n\t\tfor (var pai in def[hua]) {\r\n\t\t\tvar cv=cardv(hua+pai);\r\n\t\t\tif (cv)\tmap[cv.ov]=def[hua][pai];\r\n\t\t}\r\n\t}\r\n})();\r\n\r\nmodule.exports=def.map;\n\n\n// WEBPACK FOOTER //\n// ./client/cardImg.js","function permutator(inputArr) {\r\n  var results = [];\r\n\r\n\tfunction permute(arr, memo) {\r\n\t\tvar cur, memo = memo || [];\r\n\r\n\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\tcur = arr.splice(i, 1);\r\n\t\t\tif (arr.length === 0) {\r\n\t\t\tresults.push(memo.concat(cur));\r\n\t\t\t}\r\n\t\t\tpermute(arr.slice(), memo.concat(cur));\r\n\t\t\tarr.splice(i, 0, cur[0]);\r\n\t\t}\r\n\r\n\t\treturn results;\r\n\t}\r\n\r\n\treturn permute(inputArr);\r\n}\r\n\r\nvar cardType={'黑桃':3, '红桃':2, '梅花':1, '方块':0, 'heitao':3, 'hongtao':2, 'meihua':1, 'fangkuai':0};\r\nfunction cardv(c) {\r\n\tif (typeof c=='number') return {t:Math.floor(c%4), v:Math.floor(c/4), ov:c};\r\n\tif (typeof c=='string') {\r\n\t\tfor (var k in cardType) {\r\n\t\t\tif (c.indexOf(k)==0) {\r\n\t\t\t\tvar t=cardType[k];\r\n\t\t\t\tvar v=c.slice(k.length);\r\n\t\t\t\tswitch (v.toLowerCase()) {\r\n\t\t\t\t\tcase 'a':\r\n\t\t\t\t\tv=0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'j':\r\n\t\t\t\t\tv=10;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'q':\r\n\t\t\t\t\tv=11;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'k':\r\n\t\t\t\t\tv=12;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\tv=Number(v)-1;\r\n\t\t\t\t}\r\n\t\t\t\treturn {t:t, v:v, ov:v*4+t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\nvar reverseCardType=['方块', '梅花','红桃', '黑桃'];\r\nvar reverseCardValue=['A', 2, 3, 4, 5, 6, 7, 8, 9,10, 'J', 'Q', 'K'];\r\nvar niuValue=[,'一','二','三','四','五','六','七','八','九'];\r\nfunction parseR(r) {\r\n\tswitch (r.t) {\r\n\t\tcase 0:\r\n\t\tr._t='没牛';\r\n\t\tbreak;\r\n\t\tcase 1:\r\n\t\tr._t='牛'+niuValue[r.v];\r\n\t\tbreak;\r\n\t\tcase 2:\r\n\t\tr._t='牛'+niuValue[r.v];\r\n\t\tbreak;\r\n\t\tcase 3:\r\n\t\tr._t='牛牛';\r\n\t\tbreak;\r\n\t\tcase 4:\r\n\t\tr._t='四花牛';\r\n\t\tbreak;\r\n\t\tcase 5:\r\n\t\tr._t='五花牛';\r\n\t\tbreak;\r\n\t\tcase 7:\r\n\t\tr._t='四炸牛';\r\n\t\tbreak;\r\n\t\tcase 10:\r\n\t\tr._t='五小牛';\r\n\t\tbreak;\r\n\t\tdefault:\r\n\t\tr._t='err t';\r\n\t}\r\n\tr.mc.str=reverseCardType[r.mc.t]+reverseCardValue[r.mc.v];\r\n\treturn r;\r\n}\r\nfunction fixv(v) {\r\n\tif (v>=10) return 10;\r\n\treturn v+1;\r\n}\r\nfunction isXiaoniuniu(arr) {\r\n\tvar total=0;\r\n\tfor (var i=0; i<arr.length; i++) {\r\n\t\tif (arr[i].v>=5) return false;\r\n\t\ttotal+=arr[i].v;\r\n\t}\r\n\tif (total>10) return false;\r\n\treturn true;\r\n}\r\n// tao xin mei fang\r\nfunction calcR(arr) {\r\n\tfor (var i=0; i<arr.length; i++) arr[i].fv=fixv(arr[i].v);\r\n\tfor (var i=0; i<arr.length; i++) {\r\n\t\tfor (var j=i+1; j<arr.length; j++) {\r\n\t\t\tif (arr[i].ov>arr[j].ov) {\r\n\t\t\t\tvar t=arr[j];\r\n\t\t\t\tarr[j]=arr[i]; arr[i]=t;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//小牛牛×10：五张牌皆小于等于5，总和小于等于10\r\n\tvar mc=arr[arr.length-1];\r\n\tif (isXiaoniuniu(arr)) return {t:10, mc:mc};\r\n\r\n\t// is bomb 炸弹×7：四张同数字牌。第5张随意\r\n\tif (arr[0].v==arr[3].v || arr[1].v==arr[4].v) {\r\n\t\treturn {t:7, mc:arr[1]};\r\n\t}\r\n\t// is 5 flower 五花×5：五张牌皆为J，Q，K中任意。\r\n\tvar c=0, o=null;\r\n\tfor (var i=0 ;i<arr.length; i++) {\r\n\t\tif (arr[i].v>=10) c++;\r\n\t\telse o=arr[i].v;\r\n\t}\r\n\tif (c==5) return {t:5, mc:mc};\r\n\t//四花×4：四张牌皆为J，Q，K中任意。第5张为10。\r\n\tif (c==4 && o==9) return {t:4, mc:mc};\r\n\r\n\t// 牛牛×3：三张牌数字总和为10的倍数，另两张数字总和也为10的倍数。\r\n\tvar allp=permutator(arr);\r\n\tvar maxr={t:0, v:0, f:0};\r\n\tfor (var i=0; i<allp.length; i++) {\r\n\t\tvar op=allp[i];\r\n\t\t//console.log(op);\r\n\t\tif ((op[0].fv+op[1].fv+op[2].fv)%10==0) {\r\n\t\t\tvar v=(op[3].fv+op[4].fv)%10;\r\n\t\t\tvar t=1;\r\n\t\t\tif (v==0) {\r\n\t\t\t\tv=10;t=3;\r\n\t\t\t}\r\n\t\t\telse if (v>=7) {t=2;}\r\n\t\t\tif ((maxr.t<t) || (maxr.t==t && maxr.v<v)) {\r\n\t\t\t\tmaxr.v=v;maxr.t=t;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn {t:maxr.t, mc:mc, v:maxr.v};\r\n}\r\n\r\nmodule.exports={\r\n\tcalcR:calcR,\r\n\tparseR:parseR,\r\n\tcardv:cardv,\r\n\tfixv:fixv,\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./client/rule.js","'use strict'\nvar EventEmitter=require('events');\n\nclass WaitableEvent extends EventEmitter {\n\tconstructor(waitEvent, opt) {\n\t\tsuper();\n\t\tthis.waitEvent=waitEvent;\n\t\tif (!opt) this.delayAll=true;\n\t\tthis._opt=opt;\n\t\tthis._e=[];\n\t\tthis._delay=true;\n\t}\n\tchkDelay(op) {\n\t\tif (!this._delay) return false;\n\t\tif (this.delayAll) return true;\n\t\tif (this._opt.cmds.indexOf(op)>=0) return true;\n\t\treturn false;\n\t}\n\temit(op) {\n\t\tif (op==this.waitEvent) {\n\t\t\tthis._delay=false;\n\t\t\tsuper.emit.apply(this, arguments);\n\t\t\tif (this._e instanceof Array) {\n\t\t\t\tfor (var i=0; i<this._e.length; i++) {\n\t\t\t\t\tsuper.emit.apply(this, this._e[i]);\n\t\t\t\t}\n\t\t\t\tdelete this._e;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif (this.chkDelay(op)) {\n\t\t\treturn this._e.push(arguments);\n\t\t}\n\t\tsuper.emit.apply(this, arguments);\n\t}\n}\n\nmodule.exports=WaitableEvent;\n\nif (module==require.main) {\n\tvar waitE=new WaitableEvent('go');\n\twaitE.on('userin', console.log)\n\t.on('userout', console.log)\n\t.on('go', console.log);\n\n\twaitE.emit('userin', 1, 2, 3);\n\twaitE.emit('userout', 2, 3,4);\n\twaitE.emit('go', 8);\n\twaitE.emit('userin', 'in again');\n}\n\n\n// WEBPACK FOOTER //\n// ./client/waitableEvent.js","module.exports = __webpack_public_path__ + \"bgm2.mp3?1811da5a920109fb631deda9cea942d3\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./client/res/snd/bgm2.mp3\n// module id = 81\n// module chunks = 6","require('./libs/peer.js');\nvar EventEmitter=require('events');\nclass SafePeer extends EventEmitter {\n\tconstructor(id, opt) {\n\t\tsuper();\n\t\tthis._id=id;\n\t\tthis._opt=opt;\n\t\tthis._delayOp=[];\n\t\tthis._start();\n\t}\n\t_start() {\n\t\tconsole.log('peer started');\n\t\tvar self=this;\n\t\tthis._peer=new Peer(this._id, this._opt)\n\t\t.on('open', function() {\n\t\t\tif (self._delayOp.length) {\n\t\t\t\tfor (var i=0, l=self._delayOp.length; i<l; i++) {\n\t\t\t\t\tself.call.apply(null, self._delayOp[i]);\n\t\t\t\t}\n\t\t\t\tself._delayOp=[];\n\t\t\t}\n\t\t\tself.emit('open');\n\t\t})\n\t\t.on('call', function(call) {\n\t\t\tconsole.log('called from', call.metadata);\n\t\t\tself.emit('call', call);\n\t\t})\n\t\t.on('error', function(err) {\n\t\t\tconsole.log(err.message, err.type);\n\t\t\tif (err.type=='network') {\n\t\t\t\tself._peer.destory && self._peer.destory();\n\t\t\t\tself._peer=null;\n\t\t\t\treturn self.retry();\n\t\t\t}\n\t\t\tself.emit('low-level-error', err);\n\t\t});\n\t}\n\tretry() {\n\t\tsetTimeout(this._start.bind(this), 1000);\n\t}\n\tcall(id, stream, opt, cb) {\n\t\tif (!this._peer || this._peer.disconnected) return this._delayOp.push(arguments);\n\t\treturn cb(null, this._peer.call(id, stream, opt));\n\t}\n\tclose() {\n\t\tthis._peer && this._peer.close();\n\t}\n}\n\nmodule.exports=SafePeer;\n\n\n// WEBPACK FOOTER //\n// ./client/safePeer.js","/*! peerjs build:0.3.13, development. Copyright(c) 2013 Michelle Bu <michelle@michellebu.com> */(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nmodule.exports.RTCSessionDescription = window.RTCSessionDescription ||\n\twindow.mozRTCSessionDescription;\nmodule.exports.RTCPeerConnection = window.RTCPeerConnection ||\n\twindow.mozRTCPeerConnection || window.webkitRTCPeerConnection;\nmodule.exports.RTCIceCandidate = window.RTCIceCandidate ||\n\twindow.mozRTCIceCandidate;\n\n},{}],2:[function(require,module,exports){\nvar util = require('./util');\nvar EventEmitter = require('eventemitter3');\nvar Negotiator = require('./negotiator');\nvar Reliable = require('reliable');\n\n/**\n * Wraps a DataChannel between two Peers.\n */\nfunction DataConnection(peer, provider, options) {\n  if (!(this instanceof DataConnection)) return new DataConnection(peer, provider, options);\n  EventEmitter.call(this);\n\n  this.options = util.extend({\n    serialization: 'binary',\n    reliable: false\n  }, options);\n\n  // Connection is not open yet.\n  this.open = false;\n  this.type = 'data';\n  this.peer = peer;\n  this.provider = provider;\n\n  this.id = this.options.connectionId || DataConnection._idPrefix + util.randomToken();\n\n  this.label = this.options.label || this.id;\n  this.metadata = this.options.metadata;\n  this.serialization = this.options.serialization;\n  this.reliable = this.options.reliable;\n\n  // Data channel buffering.\n  this._buffer = [];\n  this._buffering = false;\n  this.bufferSize = 0;\n\n  // For storing large data.\n  this._chunkedData = {};\n\n  if (this.options._payload) {\n    this._peerBrowser = this.options._payload.browser;\n  }\n\n  Negotiator.startConnection(\n    this,\n    this.options._payload || {\n      originator: true\n    }\n  );\n}\n\nutil.inherits(DataConnection, EventEmitter);\n\nDataConnection._idPrefix = 'dc_';\n\n/** Called by the Negotiator when the DataChannel is ready. */\nDataConnection.prototype.initialize = function(dc) {\n  this._dc = this.dataChannel = dc;\n  this._configureDataChannel();\n}\n\nDataConnection.prototype._configureDataChannel = function() {\n  var self = this;\n  if (util.supports.sctp) {\n    this._dc.binaryType = 'arraybuffer';\n  }\n  this._dc.onopen = function() {\n    util.log('Data channel connection success');\n    self.open = true;\n    self.emit('open');\n  }\n\n  // Use the Reliable shim for non Firefox browsers\n  if (!util.supports.sctp && this.reliable) {\n    this._reliable = new Reliable(this._dc, util.debug);\n  }\n\n  if (this._reliable) {\n    this._reliable.onmessage = function(msg) {\n      self.emit('data', msg);\n    };\n  } else {\n    this._dc.onmessage = function(e) {\n      self._handleDataMessage(e);\n    };\n  }\n  this._dc.onclose = function(e) {\n    util.log('DataChannel closed for:', self.peer);\n    self.close();\n  };\n}\n\n// Handles a DataChannel message.\nDataConnection.prototype._handleDataMessage = function(e) {\n  var self = this;\n  var data = e.data;\n  var datatype = data.constructor;\n  if (this.serialization === 'binary' || this.serialization === 'binary-utf8') {\n    if (datatype === Blob) {\n      // Datatype should never be blob\n      util.blobToArrayBuffer(data, function(ab) {\n        data = util.unpack(ab);\n        self.emit('data', data);\n      });\n      return;\n    } else if (datatype === ArrayBuffer) {\n      data = util.unpack(data);\n    } else if (datatype === String) {\n      // String fallback for binary data for browsers that don't support binary yet\n      var ab = util.binaryStringToArrayBuffer(data);\n      data = util.unpack(ab);\n    }\n  } else if (this.serialization === 'json') {\n    data = JSON.parse(data);\n  }\n\n  // Check if we've chunked--if so, piece things back together.\n  // We're guaranteed that this isn't 0.\n  if (data.__peerData) {\n    var id = data.__peerData;\n    var chunkInfo = this._chunkedData[id] || {data: [], count: 0, total: data.total};\n\n    chunkInfo.data[data.n] = data.data;\n    chunkInfo.count += 1;\n\n    if (chunkInfo.total === chunkInfo.count) {\n      // Clean up before making the recursive call to `_handleDataMessage`.\n      delete this._chunkedData[id];\n\n      // We've received all the chunks--time to construct the complete data.\n      data = new Blob(chunkInfo.data);\n      this._handleDataMessage({data: data});\n    }\n\n    this._chunkedData[id] = chunkInfo;\n    return;\n  }\n\n  this.emit('data', data);\n}\n\n/**\n * Exposed functionality for users.\n */\n\n/** Allows user to close connection. */\nDataConnection.prototype.close = function() {\n  if (!this.open) {\n    return;\n  }\n  this.open = false;\n  Negotiator.cleanup(this);\n  this.emit('close');\n}\n\n/** Allows user to send data. */\nDataConnection.prototype.send = function(data, chunked) {\n  if (!this.open) {\n    this.emit('error', new Error('Connection is not open. You should listen for the `open` event before sending messages.'));\n    return;\n  }\n  if (this._reliable) {\n    // Note: reliable shim sending will make it so that you cannot customize\n    // serialization.\n    this._reliable.send(data);\n    return;\n  }\n  var self = this;\n  if (this.serialization === 'json') {\n    this._bufferedSend(JSON.stringify(data));\n  } else if (this.serialization === 'binary' || this.serialization === 'binary-utf8') {\n    var blob = util.pack(data);\n\n    // For Chrome-Firefox interoperability, we need to make Firefox \"chunk\"\n    // the data it sends out.\n    var needsChunking = util.chunkedBrowsers[this._peerBrowser] || util.chunkedBrowsers[util.browser];\n    if (needsChunking && !chunked && blob.size > util.chunkedMTU) {\n      this._sendChunks(blob);\n      return;\n    }\n\n    // DataChannel currently only supports strings.\n    if (!util.supports.sctp) {\n      util.blobToBinaryString(blob, function(str) {\n        self._bufferedSend(str);\n      });\n    } else if (!util.supports.binaryBlob) {\n      // We only do this if we really need to (e.g. blobs are not supported),\n      // because this conversion is costly.\n      util.blobToArrayBuffer(blob, function(ab) {\n        self._bufferedSend(ab);\n      });\n    } else {\n      this._bufferedSend(blob);\n    }\n  } else {\n    this._bufferedSend(data);\n  }\n}\n\nDataConnection.prototype._bufferedSend = function(msg) {\n  if (this._buffering || !this._trySend(msg)) {\n    this._buffer.push(msg);\n    this.bufferSize = this._buffer.length;\n  }\n}\n\n// Returns true if the send succeeds.\nDataConnection.prototype._trySend = function(msg) {\n  try {\n    this._dc.send(msg);\n  } catch (e) {\n    this._buffering = true;\n\n    var self = this;\n    setTimeout(function() {\n      // Try again.\n      self._buffering = false;\n      self._tryBuffer();\n    }, 100);\n    return false;\n  }\n  return true;\n}\n\n// Try to send the first message in the buffer.\nDataConnection.prototype._tryBuffer = function() {\n  if (this._buffer.length === 0) {\n    return;\n  }\n\n  var msg = this._buffer[0];\n\n  if (this._trySend(msg)) {\n    this._buffer.shift();\n    this.bufferSize = this._buffer.length;\n    this._tryBuffer();\n  }\n}\n\nDataConnection.prototype._sendChunks = function(blob) {\n  var blobs = util.chunk(blob);\n  for (var i = 0, ii = blobs.length; i < ii; i += 1) {\n    var blob = blobs[i];\n    this.send(blob, true);\n  }\n}\n\nDataConnection.prototype.handleMessage = function(message) {\n  var payload = message.payload;\n\n  switch (message.type) {\n    case 'ANSWER':\n      this._peerBrowser = payload.browser;\n\n      // Forward to negotiator\n      Negotiator.handleSDP(message.type, this, payload.sdp);\n      break;\n    case 'CANDIDATE':\n      Negotiator.handleCandidate(this, payload.candidate);\n      break;\n    default:\n      util.warn('Unrecognized message type:', message.type, 'from peer:', this.peer);\n      break;\n  }\n}\n\nmodule.exports = DataConnection;\n\n},{\"./negotiator\":5,\"./util\":8,\"eventemitter3\":9,\"reliable\":12}],3:[function(require,module,exports){\nwindow.Socket = require('./socket');\nwindow.MediaConnection = require('./mediaconnection');\nwindow.DataConnection = require('./dataconnection');\nwindow.Peer = require('./peer');\nwindow.RTCPeerConnection = require('./adapter').RTCPeerConnection;\nwindow.RTCSessionDescription = require('./adapter').RTCSessionDescription;\nwindow.RTCIceCandidate = require('./adapter').RTCIceCandidate;\nwindow.Negotiator = require('./negotiator');\nwindow.util = require('./util');\nwindow.BinaryPack = require('js-binarypack');\n\n},{\"./adapter\":1,\"./dataconnection\":2,\"./mediaconnection\":4,\"./negotiator\":5,\"./peer\":6,\"./socket\":7,\"./util\":8,\"js-binarypack\":10}],4:[function(require,module,exports){\nvar util = require('./util');\nvar EventEmitter = require('eventemitter3');\nvar Negotiator = require('./negotiator');\n\n/**\n * Wraps the streaming interface between two Peers.\n */\nfunction MediaConnection(peer, provider, options) {\n  if (!(this instanceof MediaConnection)) return new MediaConnection(peer, provider, options);\n  EventEmitter.call(this);\n\n  this.options = util.extend({}, options);\n\n  this.open = false;\n  this.type = 'media';\n  this.peer = peer;\n  this.provider = provider;\n  this.metadata = this.options.metadata;\n  this.localStream = this.options._stream;\n\n  this.id = this.options.connectionId || MediaConnection._idPrefix + util.randomToken();\n  if (this.localStream) {\n    Negotiator.startConnection(\n      this,\n      {_stream: this.localStream, originator: true}\n    );\n  }\n};\n\nutil.inherits(MediaConnection, EventEmitter);\n\nMediaConnection._idPrefix = 'mc_';\n\nMediaConnection.prototype.addStream = function(remoteStream) {\n  util.log('Receiving stream', remoteStream);\n\n  this.remoteStream = remoteStream;\n  this.emit('stream', remoteStream); // Should we call this `open`?\n\n};\n\nMediaConnection.prototype.handleMessage = function(message) {\n  var payload = message.payload;\n\n  switch (message.type) {\n    case 'ANSWER':\n      // Forward to negotiator\n      Negotiator.handleSDP(message.type, this, payload.sdp);\n      this.open = true;\n      break;\n    case 'CANDIDATE':\n      Negotiator.handleCandidate(this, payload.candidate);\n      break;\n    default:\n      util.warn('Unrecognized message type:', message.type, 'from peer:', this.peer);\n      break;\n  }\n}\n\nMediaConnection.prototype.answer = function(stream) {\n  if (this.localStream) {\n    util.warn('Local stream already exists on this MediaConnection. Are you answering a call twice?');\n    return;\n  }\n\n  this.options._payload._stream = stream;\n\n  this.localStream = stream;\n  Negotiator.startConnection(\n    this,\n    this.options._payload\n  )\n  // Retrieve lost messages stored because PeerConnection not set up.\n  var messages = this.provider._getMessages(this.id);\n  for (var i = 0, ii = messages.length; i < ii; i += 1) {\n    this.handleMessage(messages[i]);\n  }\n  this.open = true;\n};\n\n/**\n * Exposed functionality for users.\n */\n\n/** Allows user to close connection. */\nMediaConnection.prototype.close = function() {\n  if (!this.open) {\n    return;\n  }\n  this.open = false;\n  Negotiator.cleanup(this);\n  this.emit('close')\n};\n\nmodule.exports = MediaConnection;\n\n},{\"./negotiator\":5,\"./util\":8,\"eventemitter3\":9}],5:[function(require,module,exports){\nvar util = require('./util');\nvar RTCPeerConnection = require('./adapter').RTCPeerConnection;\nvar RTCSessionDescription = require('./adapter').RTCSessionDescription;\nvar RTCIceCandidate = require('./adapter').RTCIceCandidate;\n\n/**\n * Manages all negotiations between Peers.\n */\nvar Negotiator = {\n  pcs: {\n    data: {},\n    media: {}\n  }, // type => {peerId: {pc_id: pc}}.\n  //providers: {}, // provider's id => providers (there may be multiple providers/client.\n  queue: [] // connections that are delayed due to a PC being in use.\n}\n\nNegotiator._idPrefix = 'pc_';\n\n/** Returns a PeerConnection object set up correctly (for data, media). */\nNegotiator.startConnection = function(connection, options) {\n  var pc = Negotiator._getPeerConnection(connection, options);\n\n  if (connection.type === 'media' && options._stream) {\n    // Add the stream.\n    pc.addStream(options._stream);\n  }\n\n  // Set the connection's PC.\n  connection.pc = connection.peerConnection = pc;\n  // What do we need to do now?\n  if (options.originator) {\n    if (connection.type === 'data') {\n      // Create the datachannel.\n      var config = {};\n      // Dropping reliable:false support, since it seems to be crashing\n      // Chrome.\n      /*if (util.supports.sctp && !options.reliable) {\n        // If we have canonical reliable support...\n        config = {maxRetransmits: 0};\n      }*/\n      // Fallback to ensure older browsers don't crash.\n      if (!util.supports.sctp) {\n        config = {reliable: options.reliable};\n      }\n      var dc = pc.createDataChannel(connection.label, config);\n      connection.initialize(dc);\n    }\n\n    if (!util.supports.onnegotiationneeded) {\n      Negotiator._makeOffer(connection);\n    }\n  } else {\n    Negotiator.handleSDP('OFFER', connection, options.sdp);\n  }\n}\n\nNegotiator._getPeerConnection = function(connection, options) {\n  if (!Negotiator.pcs[connection.type]) {\n    util.error(connection.type + ' is not a valid connection type. Maybe you overrode the `type` property somewhere.');\n  }\n\n  if (!Negotiator.pcs[connection.type][connection.peer]) {\n    Negotiator.pcs[connection.type][connection.peer] = {};\n  }\n  var peerConnections = Negotiator.pcs[connection.type][connection.peer];\n\n  var pc;\n  // Not multiplexing while FF and Chrome have not-great support for it.\n  /*if (options.multiplex) {\n    ids = Object.keys(peerConnections);\n    for (var i = 0, ii = ids.length; i < ii; i += 1) {\n      pc = peerConnections[ids[i]];\n      if (pc.signalingState === 'stable') {\n        break; // We can go ahead and use this PC.\n      }\n    }\n  } else */\n  if (options.pc) { // Simplest case: PC id already provided for us.\n    pc = Negotiator.pcs[connection.type][connection.peer][options.pc];\n  }\n\n  if (!pc || pc.signalingState !== 'stable') {\n    pc = Negotiator._startPeerConnection(connection);\n  }\n  return pc;\n}\n\n/*\nNegotiator._addProvider = function(provider) {\n  if ((!provider.id && !provider.disconnected) || !provider.socket.open) {\n    // Wait for provider to obtain an ID.\n    provider.on('open', function(id) {\n      Negotiator._addProvider(provider);\n    });\n  } else {\n    Negotiator.providers[provider.id] = provider;\n  }\n}*/\n\n\n/** Start a PC. */\nNegotiator._startPeerConnection = function(connection) {\n  util.log('Creating RTCPeerConnection.');\n\n  var id = Negotiator._idPrefix + util.randomToken();\n  var optional = {};\n\n  if (connection.type === 'data' && !util.supports.sctp) {\n    optional = {optional: [{RtpDataChannels: true}]};\n  } else if (connection.type === 'media') {\n    // Interop req for chrome.\n    optional = {optional: [{DtlsSrtpKeyAgreement: true}]};\n  }\n\n  var pc = new RTCPeerConnection(connection.provider.options.config, optional);\n  Negotiator.pcs[connection.type][connection.peer][id] = pc;\n\n  Negotiator._setupListeners(connection, pc, id);\n\n  return pc;\n}\n\n/** Set up various WebRTC listeners. */\nNegotiator._setupListeners = function(connection, pc, pc_id) {\n  var peerId = connection.peer;\n  var connectionId = connection.id;\n  var provider = connection.provider;\n\n  // ICE CANDIDATES.\n  util.log('Listening for ICE candidates.');\n  pc.onicecandidate = function(evt) {\n    if (evt.candidate) {\n      util.log('Received ICE candidates for:', connection.peer);\n      provider.socket.send({\n        type: 'CANDIDATE',\n        payload: {\n          candidate: evt.candidate,\n          type: connection.type,\n          connectionId: connection.id\n        },\n        dst: peerId\n      });\n    }\n  };\n\n  pc.oniceconnectionstatechange = function() {\n    switch (pc.iceConnectionState) {\n      case 'disconnected':\n      case 'failed':\n        util.log('iceConnectionState is disconnected, closing connections to ' + peerId);\n        connection.close();\n        break;\n      case 'completed':\n        pc.onicecandidate = util.noop;\n        break;\n    }\n  };\n\n  // Fallback for older Chrome impls.\n  pc.onicechange = pc.oniceconnectionstatechange;\n\n  // ONNEGOTIATIONNEEDED (Chrome)\n  util.log('Listening for `negotiationneeded`');\n  pc.onnegotiationneeded = function() {\n    util.log('`negotiationneeded` triggered');\n    if (pc.signalingState == 'stable') {\n      Negotiator._makeOffer(connection);\n    } else {\n      util.log('onnegotiationneeded triggered when not stable. Is another connection being established?');\n    }\n  };\n\n  // DATACONNECTION.\n  util.log('Listening for data channel');\n  // Fired between offer and answer, so options should already be saved\n  // in the options hash.\n  pc.ondatachannel = function(evt) {\n    util.log('Received data channel');\n    var dc = evt.channel;\n    var connection = provider.getConnection(peerId, connectionId);\n    connection.initialize(dc);\n  };\n\n  // MEDIACONNECTION.\n  util.log('Listening for remote stream');\n  pc.onaddstream = function(evt) {\n    util.log('Received remote stream');\n    var stream = evt.stream;\n    var connection = provider.getConnection(peerId, connectionId);\n    // 10/10/2014: looks like in Chrome 38, onaddstream is triggered after\n    // setting the remote description. Our connection object in these cases\n    // is actually a DATA connection, so addStream fails.\n    // TODO: This is hopefully just a temporary fix. We should try to\n    // understand why this is happening.\n    if (connection.type === 'media') {\n      connection.addStream(stream);\n    }\n  };\n}\n\nNegotiator.cleanup = function(connection) {\n  util.log('Cleaning up PeerConnection to ' + connection.peer);\n\n  var pc = connection.pc;\n\n  if (!!pc && (pc.readyState !== 'closed' || pc.signalingState !== 'closed')) {\n    pc.close();\n    connection.pc = null;\n  }\n}\n\nNegotiator._makeOffer = function(connection) {\n  var pc = connection.pc;\n  pc.createOffer(function(offer) {\n    util.log('Created offer.');\n\n    if (!util.supports.sctp && connection.type === 'data' && connection.reliable) {\n      offer.sdp = Reliable.higherBandwidthSDP(offer.sdp);\n    }\n\n    pc.setLocalDescription(offer, function() {\n      util.log('Set localDescription: offer', 'for:', connection.peer);\n      connection.provider.socket.send({\n        type: 'OFFER',\n        payload: {\n          sdp: offer,\n          type: connection.type,\n          label: connection.label,\n          connectionId: connection.id,\n          reliable: connection.reliable,\n          serialization: connection.serialization,\n          metadata: connection.metadata,\n          browser: util.browser\n        },\n        dst: connection.peer\n      });\n    }, function(err) {\n      connection.provider.emitError('webrtc', err);\n      util.log('Failed to setLocalDescription, ', err);\n    });\n  }, function(err) {\n    connection.provider.emitError('webrtc', err);\n    util.log('Failed to createOffer, ', err);\n  }, connection.options.constraints);\n}\n\nNegotiator._makeAnswer = function(connection) {\n  var pc = connection.pc;\n\n  pc.createAnswer(function(answer) {\n    util.log('Created answer.');\n\n    if (!util.supports.sctp && connection.type === 'data' && connection.reliable) {\n      answer.sdp = Reliable.higherBandwidthSDP(answer.sdp);\n    }\n\n    pc.setLocalDescription(answer, function() {\n      util.log('Set localDescription: answer', 'for:', connection.peer);\n      connection.provider.socket.send({\n        type: 'ANSWER',\n        payload: {\n          sdp: answer,\n          type: connection.type,\n          connectionId: connection.id,\n          browser: util.browser\n        },\n        dst: connection.peer\n      });\n    }, function(err) {\n      connection.provider.emitError('webrtc', err);\n      util.log('Failed to setLocalDescription, ', err);\n    });\n  }, function(err) {\n    connection.provider.emitError('webrtc', err);\n    util.log('Failed to create answer, ', err);\n  });\n}\n\n/** Handle an SDP. */\nNegotiator.handleSDP = function(type, connection, sdp) {\n  sdp = new RTCSessionDescription(sdp);\n  var pc = connection.pc;\n\n  util.log('Setting remote description', sdp);\n  pc.setRemoteDescription(sdp, function() {\n    util.log('Set remoteDescription:', type, 'for:', connection.peer);\n\n    if (type === 'OFFER') {\n      Negotiator._makeAnswer(connection);\n    }\n  }, function(err) {\n    connection.provider.emitError('webrtc', err);\n    util.log('Failed to setRemoteDescription, ', err);\n  });\n}\n\n/** Handle a candidate. */\nNegotiator.handleCandidate = function(connection, ice) {\n  var candidate = ice.candidate;\n  var sdpMLineIndex = ice.sdpMLineIndex;\n  connection.pc.addIceCandidate(new RTCIceCandidate({\n    sdpMLineIndex: sdpMLineIndex,\n    candidate: candidate\n  }));\n  util.log('Added ICE candidate for:', connection.peer);\n}\n\nmodule.exports = Negotiator;\n\n},{\"./adapter\":1,\"./util\":8}],6:[function(require,module,exports){\nvar util = require('./util');\nvar EventEmitter = require('eventemitter3');\nvar Socket = require('./socket');\nvar MediaConnection = require('./mediaconnection');\nvar DataConnection = require('./dataconnection');\n\n/**\n * A peer who can initiate connections with other peers.\n */\nfunction Peer(id, options) {\n  if (!(this instanceof Peer)) return new Peer(id, options);\n  EventEmitter.call(this);\n\n  // Deal with overloading\n  if (id && id.constructor == Object) {\n    options = id;\n    id = undefined;\n  } else if (id) {\n    // Ensure id is a string\n    id = id.toString();\n  }\n  //\n\n  // Configurize options\n  options = util.extend({\n    debug: 0, // 1: Errors, 2: Warnings, 3: All logs\n    host: util.CLOUD_HOST,\n    port: util.CLOUD_PORT,\n    key: 'peerjs',\n    path: '/',\n    token: util.randomToken(),\n    config: util.defaultConfig\n  }, options);\n  this.options = options;\n  // Detect relative URL host.\n  if (options.host === '/') {\n    options.host = window.location.hostname;\n  }\n  // Set path correctly.\n  if (options.path[0] !== '/') {\n    options.path = '/' + options.path;\n  }\n  if (options.path[options.path.length - 1] !== '/') {\n    options.path += '/';\n  }\n\n  // Set whether we use SSL to same as current host\n  if (options.secure === undefined && options.host !== util.CLOUD_HOST) {\n    options.secure = util.isSecure();\n  }\n  // Set a custom log function if present\n  if (options.logFunction) {\n    util.setLogFunction(options.logFunction);\n  }\n  util.setLogLevel(options.debug);\n  //\n\n  // Sanity checks\n  // Ensure WebRTC supported\n  if (!util.supports.audioVideo && !util.supports.data ) {\n    this._delayedAbort('browser-incompatible', 'The current browser does not support WebRTC');\n    return;\n  }\n  // Ensure alphanumeric id\n  if (!util.validateId(id)) {\n    this._delayedAbort('invalid-id', 'ID \"' + id + '\" is invalid');\n    return;\n  }\n  // Ensure valid key\n  if (!util.validateKey(options.key)) {\n    this._delayedAbort('invalid-key', 'API KEY \"' + options.key + '\" is invalid');\n    return;\n  }\n  // Ensure not using unsecure cloud server on SSL page\n  if (options.secure && options.host === '0.peerjs.com') {\n    this._delayedAbort('ssl-unavailable',\n      'The cloud server currently does not support HTTPS. Please run your own PeerServer to use HTTPS.');\n    return;\n  }\n  //\n\n  // States.\n  this.destroyed = false; // Connections have been killed\n  this.disconnected = false; // Connection to PeerServer killed but P2P connections still active\n  this.open = false; // Sockets and such are not yet open.\n  //\n\n  // References\n  this.connections = {}; // DataConnections for this peer.\n  this._lostMessages = {}; // src => [list of messages]\n  //\n\n  // Start the server connection\n  this._initializeServerConnection();\n  if (id) {\n    this._initialize(id);\n  } else {\n    this._retrieveId();\n  }\n  //\n}\n\nutil.inherits(Peer, EventEmitter);\n\n// Initialize the 'socket' (which is actually a mix of XHR streaming and\n// websockets.)\nPeer.prototype._initializeServerConnection = function() {\n  var self = this;\n  this.socket = new Socket(this.options.secure, this.options.host, this.options.port, this.options.path, this.options.key);\n  this.socket.on('message', function(data) {\n    self._handleMessage(data);\n  });\n  this.socket.on('error', function(error) {\n    self._abort('socket-error', error);\n  });\n  this.socket.on('disconnected', function() {\n    // If we haven't explicitly disconnected, emit error and disconnect.\n    if (!self.disconnected) {\n      self.emitError('network', 'Lost connection to server.');\n      self.disconnect();\n    }\n  });\n  this.socket.on('close', function() {\n    // If we haven't explicitly disconnected, emit error.\n    if (!self.disconnected) {\n      self._abort('socket-closed', 'Underlying socket is already closed.');\n    }\n  });\n};\n\n/** Get a unique ID from the server via XHR. */\nPeer.prototype._retrieveId = function(cb) {\n  var self = this;\n  var http = new XMLHttpRequest();\n  var protocol = this.options.secure ? 'https://' : 'http://';\n  var url = protocol + this.options.host + ':' + this.options.port +\n    this.options.path + this.options.key + '/id';\n  var queryString = '?ts=' + new Date().getTime() + '' + Math.random();\n  url += queryString;\n\n  // If there's no ID we need to wait for one before trying to init socket.\n  http.open('get', url, true);\n  http.onerror = function(e) {\n    util.error('Error retrieving ID', e);\n    var pathError = '';\n    if (self.options.path === '/' && self.options.host !== util.CLOUD_HOST) {\n      pathError = ' If you passed in a `path` to your self-hosted PeerServer, ' +\n        'you\\'ll also need to pass in that same path when creating a new ' +\n        'Peer.';\n    }\n    self._abort('server-error', 'Could not get an ID from the server.' + pathError);\n  };\n  http.onreadystatechange = function() {\n    if (http.readyState !== 4) {\n      return;\n    }\n    if (http.status !== 200) {\n      http.onerror();\n      return;\n    }\n    self._initialize(http.responseText);\n  };\n  http.send(null);\n};\n\n/** Initialize a connection with the server. */\nPeer.prototype._initialize = function(id) {\n  this.id = id;\n  this.socket.start(this.id, this.options.token);\n};\n\n/** Handles messages from the server. */\nPeer.prototype._handleMessage = function(message) {\n  var type = message.type;\n  var payload = message.payload;\n  var peer = message.src;\n  var connection;\n\n  switch (type) {\n    case 'OPEN': // The connection to the server is open.\n      this.emit('open', this.id);\n      this.open = true;\n      break;\n    case 'ERROR': // Server error.\n      this._abort('server-error', payload.msg);\n      break;\n    case 'ID-TAKEN': // The selected ID is taken.\n      this._abort('unavailable-id', 'ID `' + this.id + '` is taken');\n      break;\n    case 'INVALID-KEY': // The given API key cannot be found.\n      this._abort('invalid-key', 'API KEY \"' + this.options.key + '\" is invalid');\n      break;\n\n    //\n    case 'LEAVE': // Another peer has closed its connection to this peer.\n      util.log('Received leave message from', peer);\n      this._cleanupPeer(peer);\n      break;\n\n    case 'EXPIRE': // The offer sent to a peer has expired without response.\n      this.emitError('peer-unavailable', 'Could not connect to peer ' + peer);\n      break;\n    case 'OFFER': // we should consider switching this to CALL/CONNECT, but this is the least breaking option.\n      var connectionId = payload.connectionId;\n      connection = this.getConnection(peer, connectionId);\n\n      if (connection) {\n        util.warn('Offer received for existing Connection ID:', connectionId);\n        //connection.handleMessage(message);\n      } else {\n        // Create a new connection.\n        if (payload.type === 'media') {\n          connection = new MediaConnection(peer, this, {\n            connectionId: connectionId,\n            _payload: payload,\n            metadata: payload.metadata\n          });\n          this._addConnection(peer, connection);\n          this.emit('call', connection);\n        } else if (payload.type === 'data') {\n          connection = new DataConnection(peer, this, {\n            connectionId: connectionId,\n            _payload: payload,\n            metadata: payload.metadata,\n            label: payload.label,\n            serialization: payload.serialization,\n            reliable: payload.reliable\n          });\n          this._addConnection(peer, connection);\n          this.emit('connection', connection);\n        } else {\n          util.warn('Received malformed connection type:', payload.type);\n          return;\n        }\n        // Find messages.\n        var messages = this._getMessages(connectionId);\n        for (var i = 0, ii = messages.length; i < ii; i += 1) {\n          connection.handleMessage(messages[i]);\n        }\n      }\n      break;\n    default:\n      if (!payload) {\n        util.warn('You received a malformed message from ' + peer + ' of type ' + type);\n        return;\n      }\n\n      var id = payload.connectionId;\n      connection = this.getConnection(peer, id);\n\n      if (connection && connection.pc) {\n        // Pass it on.\n        connection.handleMessage(message);\n      } else if (id) {\n        // Store for possible later use\n        this._storeMessage(id, message);\n      } else {\n        util.warn('You received an unrecognized message:', message);\n      }\n      break;\n  }\n};\n\n/** Stores messages without a set up connection, to be claimed later. */\nPeer.prototype._storeMessage = function(connectionId, message) {\n  if (!this._lostMessages[connectionId]) {\n    this._lostMessages[connectionId] = [];\n  }\n  this._lostMessages[connectionId].push(message);\n};\n\n/** Retrieve messages from lost message store */\nPeer.prototype._getMessages = function(connectionId) {\n  var messages = this._lostMessages[connectionId];\n  if (messages) {\n    delete this._lostMessages[connectionId];\n    return messages;\n  } else {\n    return [];\n  }\n};\n\n/**\n * Returns a DataConnection to the specified peer. See documentation for a\n * complete list of options.\n */\nPeer.prototype.connect = function(peer, options) {\n  if (this.disconnected) {\n    util.warn('You cannot connect to a new Peer because you called ' +\n      '.disconnect() on this Peer and ended your connection with the ' +\n      'server. You can create a new Peer to reconnect, or call reconnect ' +\n      'on this peer if you believe its ID to still be available.');\n    this.emitError('disconnected', 'Cannot connect to new Peer after disconnecting from server.');\n    return;\n  }\n  var connection = new DataConnection(peer, this, options);\n  this._addConnection(peer, connection);\n  return connection;\n};\n\n/**\n * Returns a MediaConnection to the specified peer. See documentation for a\n * complete list of options.\n */\nPeer.prototype.call = function(peer, stream, options) {\n  if (this.disconnected) {\n    util.warn('You cannot connect to a new Peer because you called ' +\n      '.disconnect() on this Peer and ended your connection with the ' +\n      'server. You can create a new Peer to reconnect.');\n    this.emitError('disconnected', 'Cannot connect to new Peer after disconnecting from server.');\n    return;\n  }\n  if (!stream) {\n    util.error('To call a peer, you must provide a stream from your browser\\'s `getUserMedia`.');\n    return;\n  }\n  options = options || {};\n  options._stream = stream;\n  var call = new MediaConnection(peer, this, options);\n  this._addConnection(peer, call);\n  return call;\n};\n\n/** Add a data/media connection to this peer. */\nPeer.prototype._addConnection = function(peer, connection) {\n  if (!this.connections[peer]) {\n    this.connections[peer] = [];\n  }\n  this.connections[peer].push(connection);\n};\n\n/** Retrieve a data/media connection for this peer. */\nPeer.prototype.getConnection = function(peer, id) {\n  var connections = this.connections[peer];\n  if (!connections) {\n    return null;\n  }\n  for (var i = 0, ii = connections.length; i < ii; i++) {\n    if (connections[i].id === id) {\n      return connections[i];\n    }\n  }\n  return null;\n};\n\nPeer.prototype._delayedAbort = function(type, message) {\n  var self = this;\n  util.setZeroTimeout(function(){\n    self._abort(type, message);\n  });\n};\n\n/**\n * Destroys the Peer and emits an error message.\n * The Peer is not destroyed if it's in a disconnected state, in which case\n * it retains its disconnected state and its existing connections.\n */\nPeer.prototype._abort = function(type, message) {\n  util.error('Aborting!');\n  if (!this._lastServerId) {\n    this.destroy();\n  } else {\n    this.disconnect();\n  }\n  this.emitError(type, message);\n};\n\n/** Emits a typed error message. */\nPeer.prototype.emitError = function(type, err) {\n  util.error('Error:', err);\n  if (typeof err === 'string') {\n    err = new Error(err);\n  }\n  err.type = type;\n  this.emit('error', err);\n};\n\n/**\n * Destroys the Peer: closes all active connections as well as the connection\n *  to the server.\n * Warning: The peer can no longer create or accept connections after being\n *  destroyed.\n */\nPeer.prototype.destroy = function() {\n  if (!this.destroyed) {\n    this._cleanup();\n    this.disconnect();\n    this.destroyed = true;\n  }\n};\n\n\n/** Disconnects every connection on this peer. */\nPeer.prototype._cleanup = function() {\n  if (this.connections) {\n    var peers = Object.keys(this.connections);\n    for (var i = 0, ii = peers.length; i < ii; i++) {\n      this._cleanupPeer(peers[i]);\n    }\n  }\n  this.emit('close');\n};\n\n/** Closes all connections to this peer. */\nPeer.prototype._cleanupPeer = function(peer) {\n  var connections = this.connections[peer];\n  for (var j = 0, jj = connections.length; j < jj; j += 1) {\n    connections[j].close();\n  }\n};\n\n/**\n * Disconnects the Peer's connection to the PeerServer. Does not close any\n *  active connections.\n * Warning: The peer can no longer create or accept connections after being\n *  disconnected. It also cannot reconnect to the server.\n */\nPeer.prototype.disconnect = function() {\n  var self = this;\n  util.setZeroTimeout(function(){\n    if (!self.disconnected) {\n      self.disconnected = true;\n      self.open = false;\n      if (self.socket) {\n        self.socket.close();\n      }\n      self.emit('disconnected', self.id);\n      self._lastServerId = self.id;\n      self.id = null;\n    }\n  });\n};\n\n/** Attempts to reconnect with the same ID. */\nPeer.prototype.reconnect = function() {\n  if (this.disconnected && !this.destroyed) {\n    util.log('Attempting reconnection to server with ID ' + this._lastServerId);\n    this.disconnected = false;\n    this._initializeServerConnection();\n    this._initialize(this._lastServerId);\n  } else if (this.destroyed) {\n    throw new Error('This peer cannot reconnect to the server. It has already been destroyed.');\n  } else if (!this.disconnected && !this.open) {\n    // Do nothing. We're still connecting the first time.\n    util.error('In a hurry? We\\'re still trying to make the initial connection!');\n  } else {\n    throw new Error('Peer ' + this.id + ' cannot reconnect because it is not disconnected from the server!');\n  }\n};\n\n/**\n * Get a list of available peer IDs. If you're running your own server, you'll\n * want to set allow_discovery: true in the PeerServer options. If you're using\n * the cloud server, email team@peerjs.com to get the functionality enabled for\n * your key.\n */\nPeer.prototype.listAllPeers = function(cb) {\n  cb = cb || function() {};\n  var self = this;\n  var http = new XMLHttpRequest();\n  var protocol = this.options.secure ? 'https://' : 'http://';\n  var url = protocol + this.options.host + ':' + this.options.port +\n    this.options.path + this.options.key + '/peers';\n  var queryString = '?ts=' + new Date().getTime() + '' + Math.random();\n  url += queryString;\n\n  // If there's no ID we need to wait for one before trying to init socket.\n  http.open('get', url, true);\n  http.onerror = function(e) {\n    self._abort('server-error', 'Could not get peers from the server.');\n    cb([]);\n  };\n  http.onreadystatechange = function() {\n    if (http.readyState !== 4) {\n      return;\n    }\n    if (http.status === 401) {\n      var helpfulError = '';\n      if (self.options.host !== util.CLOUD_HOST) {\n        helpfulError = 'It looks like you\\'re using the cloud server. You can email ' +\n          'team@peerjs.com to enable peer listing for your API key.';\n      } else {\n        helpfulError = 'You need to enable `allow_discovery` on your self-hosted ' +\n          'PeerServer to use this feature.';\n      }\n      cb([]);\n      throw new Error('It doesn\\'t look like you have permission to list peers IDs. ' + helpfulError);\n    } else if (http.status !== 200) {\n      cb([]);\n    } else {\n      cb(JSON.parse(http.responseText));\n    }\n  };\n  http.send(null);\n};\n\nmodule.exports = Peer;\n\n},{\"./dataconnection\":2,\"./mediaconnection\":4,\"./socket\":7,\"./util\":8,\"eventemitter3\":9}],7:[function(require,module,exports){\nvar util = require('./util');\nvar EventEmitter = require('eventemitter3');\n\n/**\n * An abstraction on top of WebSockets and XHR streaming to provide fastest\n * possible connection for peers.\n */\nfunction Socket(secure, host, port, path, key) {\n  if (!(this instanceof Socket)) return new Socket(secure, host, port, path, key);\n\n  EventEmitter.call(this);\n\n  // Disconnected manually.\n  this.disconnected = false;\n  this._queue = [];\n\n  var httpProtocol = secure ? 'https://' : 'http://';\n  var wsProtocol = secure ? 'wss://' : 'ws://';\n  this._httpUrl = httpProtocol + host + ':' + port + path + key;\n  this._wsUrl = wsProtocol + host + ':' + port + path + 'peerjs?key=' + key;\n}\n\nutil.inherits(Socket, EventEmitter);\n\n\n/** Check in with ID or get one from server. */\nSocket.prototype.start = function(id, token) {\n  this.id = id;\n\n  this._httpUrl += '/' + id + '/' + token;\n  this._wsUrl += '&id=' + id + '&token=' + token;\n\n  this._startXhrStream();\n  this._startWebSocket();\n}\n\n\n/** Start up websocket communications. */\nSocket.prototype._startWebSocket = function(id) {\n  var self = this;\n\n  if (this._socket) {\n    return;\n  }\n\n  this._socket = new WebSocket(this._wsUrl);\n\n  this._socket.onmessage = function(event) {\n    try {\n      var data = JSON.parse(event.data);\n    } catch(e) {\n      util.log('Invalid server message', event.data);\n      return;\n    }\n    self.emit('message', data);\n  };\n\n  this._socket.onclose = function(event) {\n    util.log('Socket closed.');\n    self.disconnected = true;\n    self.emit('disconnected');\n  };\n\n  // Take care of the queue of connections if necessary and make sure Peer knows\n  // socket is open.\n  this._socket.onopen = function() {\n    if (self._timeout) {\n      clearTimeout(self._timeout);\n      setTimeout(function(){\n        self._http.abort();\n        self._http = null;\n      }, 5000);\n    }\n    self._sendQueuedMessages();\n    util.log('Socket open');\n  };\n}\n\n/** Start XHR streaming. */\nSocket.prototype._startXhrStream = function(n) {\n  try {\n    var self = this;\n    this._http = new XMLHttpRequest();\n    this._http._index = 1;\n    this._http._streamIndex = n || 0;\n    this._http.open('post', this._httpUrl + '/id?i=' + this._http._streamIndex, true);\n    this._http.onerror = function() {\n      // If we get an error, likely something went wrong.\n      // Stop streaming.\n      clearTimeout(self._timeout);\n      self.emit('disconnected');\n    }\n    this._http.onreadystatechange = function() {\n      if (this.readyState == 2 && this.old) {\n        this.old.abort();\n        delete this.old;\n      } else if (this.readyState > 2 && this.status === 200 && this.responseText) {\n        self._handleStream(this);\n      }\n    };\n    this._http.send(null);\n    this._setHTTPTimeout();\n  } catch(e) {\n    util.log('XMLHttpRequest not available; defaulting to WebSockets');\n  }\n}\n\n\n/** Handles onreadystatechange response as a stream. */\nSocket.prototype._handleStream = function(http) {\n  // 3 and 4 are loading/done state. All others are not relevant.\n  var messages = http.responseText.split('\\n');\n\n  // Check to see if anything needs to be processed on buffer.\n  if (http._buffer) {\n    while (http._buffer.length > 0) {\n      var index = http._buffer.shift();\n      var bufferedMessage = messages[index];\n      try {\n        bufferedMessage = JSON.parse(bufferedMessage);\n      } catch(e) {\n        http._buffer.shift(index);\n        break;\n      }\n      this.emit('message', bufferedMessage);\n    }\n  }\n\n  var message = messages[http._index];\n  if (message) {\n    http._index += 1;\n    // Buffering--this message is incomplete and we'll get to it next time.\n    // This checks if the httpResponse ended in a `\\n`, in which case the last\n    // element of messages should be the empty string.\n    if (http._index === messages.length) {\n      if (!http._buffer) {\n        http._buffer = [];\n      }\n      http._buffer.push(http._index - 1);\n    } else {\n      try {\n        message = JSON.parse(message);\n      } catch(e) {\n        util.log('Invalid server message', message);\n        return;\n      }\n      this.emit('message', message);\n    }\n  }\n}\n\nSocket.prototype._setHTTPTimeout = function() {\n  var self = this;\n  this._timeout = setTimeout(function() {\n    var old = self._http;\n    if (!self._wsOpen()) {\n      self._startXhrStream(old._streamIndex + 1);\n      self._http.old = old;\n    } else {\n      old.abort();\n    }\n  }, 25000);\n}\n\n/** Is the websocket currently open? */\nSocket.prototype._wsOpen = function() {\n  return this._socket && this._socket.readyState == 1;\n}\n\n/** Send queued messages. */\nSocket.prototype._sendQueuedMessages = function() {\n  for (var i = 0, ii = this._queue.length; i < ii; i += 1) {\n    this.send(this._queue[i]);\n  }\n}\n\n/** Exposed send for DC & Peer. */\nSocket.prototype.send = function(data) {\n  if (this.disconnected) {\n    return;\n  }\n\n  // If we didn't get an ID yet, we can't yet send anything so we should queue\n  // up these messages.\n  if (!this.id) {\n    this._queue.push(data);\n    return;\n  }\n\n  if (!data.type) {\n    this.emit('error', 'Invalid message');\n    return;\n  }\n\n  var message = JSON.stringify(data);\n  if (this._wsOpen()) {\n    this._socket.send(message);\n  } else {\n    var http = new XMLHttpRequest();\n    var url = this._httpUrl + '/' + data.type.toLowerCase();\n    http.open('post', url, true);\n    http.setRequestHeader('Content-Type', 'application/json');\n    http.send(message);\n  }\n}\n\nSocket.prototype.close = function() {\n  if (!this.disconnected && this._wsOpen()) {\n    this._socket.close();\n    this.disconnected = true;\n  }\n}\n\nmodule.exports = Socket;\n\n},{\"./util\":8,\"eventemitter3\":9}],8:[function(require,module,exports){\nvar defaultConfig = {'iceServers': [{ 'url': 'stun:stun.l.google.com:19302' }]};\nvar dataCount = 1;\n\nvar BinaryPack = require('js-binarypack');\nvar RTCPeerConnection = require('./adapter').RTCPeerConnection;\n\nvar util = {\n  noop: function() {},\n\n  CLOUD_HOST: '0.peerjs.com',\n  CLOUD_PORT: 9000,\n\n  // Browsers that need chunking:\n  chunkedBrowsers: {'Chrome': 1},\n  chunkedMTU: 16300, // The original 60000 bytes setting does not work when sending data from Firefox to Chrome, which is \"cut off\" after 16384 bytes and delivered individually.\n\n  // Logging logic\n  logLevel: 0,\n  setLogLevel: function(level) {\n    var debugLevel = parseInt(level, 10);\n    if (!isNaN(parseInt(level, 10))) {\n      util.logLevel = debugLevel;\n    } else {\n      // If they are using truthy/falsy values for debug\n      util.logLevel = level ? 3 : 0;\n    }\n    util.log = util.warn = util.error = util.noop;\n    if (util.logLevel > 0) {\n      util.error = util._printWith('ERROR');\n    }\n    if (util.logLevel > 1) {\n      util.warn = util._printWith('WARNING');\n    }\n    if (util.logLevel > 2) {\n      util.log = util._print;\n    }\n  },\n  setLogFunction: function(fn) {\n    if (fn.constructor !== Function) {\n      util.warn('The log function you passed in is not a function. Defaulting to regular logs.');\n    } else {\n      util._print = fn;\n    }\n  },\n\n  _printWith: function(prefix) {\n    return function() {\n      var copy = Array.prototype.slice.call(arguments);\n      copy.unshift(prefix);\n      util._print.apply(util, copy);\n    };\n  },\n  _print: function () {\n    var err = false;\n    var copy = Array.prototype.slice.call(arguments);\n    copy.unshift('PeerJS: ');\n    for (var i = 0, l = copy.length; i < l; i++){\n      if (copy[i] instanceof Error) {\n        copy[i] = '(' + copy[i].name + ') ' + copy[i].message;\n        err = true;\n      }\n    }\n    err ? console.error.apply(console, copy) : console.log.apply(console, copy);\n  },\n  //\n\n  // Returns browser-agnostic default config\n  defaultConfig: defaultConfig,\n  //\n\n  // Returns the current browser.\n  browser: (function() {\n    if (window.mozRTCPeerConnection) {\n      return 'Firefox';\n    } else if (window.webkitRTCPeerConnection) {\n      return 'Chrome';\n    } else if (window.RTCPeerConnection) {\n      return 'Supported';\n    } else {\n      return 'Unsupported';\n    }\n  })(),\n  //\n\n  // Lists which features are supported\n  supports: (function() {\n    if (typeof RTCPeerConnection === 'undefined') {\n      return {};\n    }\n\n    var data = true;\n    var audioVideo = true;\n\n    var binaryBlob = false;\n    var sctp = false;\n    var onnegotiationneeded = !!window.webkitRTCPeerConnection;\n\n    var pc, dc;\n    try {\n      pc = new RTCPeerConnection(defaultConfig, {optional: [{RtpDataChannels: true}]});\n    } catch (e) {\n      data = false;\n      audioVideo = false;\n    }\n\n    if (data) {\n      try {\n        dc = pc.createDataChannel('_PEERJSTEST');\n      } catch (e) {\n        data = false;\n      }\n    }\n\n    if (data) {\n      // Binary test\n      try {\n        dc.binaryType = 'blob';\n        binaryBlob = true;\n      } catch (e) {\n      }\n\n      // Reliable test.\n      // Unfortunately Chrome is a bit unreliable about whether or not they\n      // support reliable.\n      var reliablePC = new RTCPeerConnection(defaultConfig, {});\n      try {\n        var reliableDC = reliablePC.createDataChannel('_PEERJSRELIABLETEST', {});\n        sctp = reliableDC.reliable;\n      } catch (e) {\n      }\n      reliablePC.close();\n    }\n\n    // FIXME: not really the best check...\n    if (audioVideo) {\n      audioVideo = !!pc.addStream;\n    }\n\n    // FIXME: this is not great because in theory it doesn't work for\n    // av-only browsers (?).\n    if (!onnegotiationneeded && data) {\n      // sync default check.\n      var negotiationPC = new RTCPeerConnection(defaultConfig, {optional: [{RtpDataChannels: true}]});\n      negotiationPC.onnegotiationneeded = function() {\n        onnegotiationneeded = true;\n        // async check.\n        if (util && util.supports) {\n          util.supports.onnegotiationneeded = true;\n        }\n      };\n      negotiationPC.createDataChannel('_PEERJSNEGOTIATIONTEST');\n\n      setTimeout(function() {\n        negotiationPC.close();\n      }, 1000);\n    }\n\n    if (pc) {\n      pc.close();\n    }\n\n    return {\n      audioVideo: audioVideo,\n      data: data,\n      binaryBlob: binaryBlob,\n      binary: sctp, // deprecated; sctp implies binary support.\n      reliable: sctp, // deprecated; sctp implies reliable data.\n      sctp: sctp,\n      onnegotiationneeded: onnegotiationneeded\n    };\n  }()),\n  //\n\n  // Ensure alphanumeric ids\n  validateId: function(id) {\n    // Allow empty ids\n    return !id || /^[A-Za-z0-9_-]+(?:[ _-][A-Za-z0-9]+)*$/.exec(id);\n  },\n\n  validateKey: function(key) {\n    // Allow empty keys\n    return !key || /^[A-Za-z0-9_-]+(?:[ _-][A-Za-z0-9]+)*$/.exec(key);\n  },\n\n\n  debug: false,\n\n  inherits: function(ctor, superCtor) {\n    ctor.super_ = superCtor;\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  },\n  extend: function(dest, source) {\n    for(var key in source) {\n      if(source.hasOwnProperty(key)) {\n        dest[key] = source[key];\n      }\n    }\n    return dest;\n  },\n  pack: BinaryPack.pack,\n  unpack: BinaryPack.unpack,\n\n  log: function () {\n    if (util.debug) {\n      var err = false;\n      var copy = Array.prototype.slice.call(arguments);\n      copy.unshift('PeerJS: ');\n      for (var i = 0, l = copy.length; i < l; i++){\n        if (copy[i] instanceof Error) {\n          copy[i] = '(' + copy[i].name + ') ' + copy[i].message;\n          err = true;\n        }\n      }\n      err ? console.error.apply(console, copy) : console.log.apply(console, copy);\n    }\n  },\n\n  setZeroTimeout: (function(global) {\n    var timeouts = [];\n    var messageName = 'zero-timeout-message';\n\n    // Like setTimeout, but only takes a function argument.\t There's\n    // no time argument (always zero) and no arguments (you have to\n    // use a closure).\n    function setZeroTimeoutPostMessage(fn) {\n      timeouts.push(fn);\n      global.postMessage(messageName, '*');\n    }\n\n    function handleMessage(event) {\n      if (event.source == global && event.data == messageName) {\n        if (event.stopPropagation) {\n          event.stopPropagation();\n        }\n        if (timeouts.length) {\n          timeouts.shift()();\n        }\n      }\n    }\n    if (global.addEventListener) {\n      global.addEventListener('message', handleMessage, true);\n    } else if (global.attachEvent) {\n      global.attachEvent('onmessage', handleMessage);\n    }\n    return setZeroTimeoutPostMessage;\n  }(window)),\n\n  // Binary stuff\n\n  // chunks a blob.\n  chunk: function(bl) {\n    var chunks = [];\n    var size = bl.size;\n    var start = index = 0;\n    var total = Math.ceil(size / util.chunkedMTU);\n    while (start < size) {\n      var end = Math.min(size, start + util.chunkedMTU);\n      var b = bl.slice(start, end);\n\n      var chunk = {\n        __peerData: dataCount,\n        n: index,\n        data: b,\n        total: total\n      };\n\n      chunks.push(chunk);\n\n      start = end;\n      index += 1;\n    }\n    dataCount += 1;\n    return chunks;\n  },\n\n  blobToArrayBuffer: function(blob, cb){\n    var fr = new FileReader();\n    fr.onload = function(evt) {\n      cb(evt.target.result);\n    };\n    fr.readAsArrayBuffer(blob);\n  },\n  blobToBinaryString: function(blob, cb){\n    var fr = new FileReader();\n    fr.onload = function(evt) {\n      cb(evt.target.result);\n    };\n    fr.readAsBinaryString(blob);\n  },\n  binaryStringToArrayBuffer: function(binary) {\n    var byteArray = new Uint8Array(binary.length);\n    for (var i = 0; i < binary.length; i++) {\n      byteArray[i] = binary.charCodeAt(i) & 0xff;\n    }\n    return byteArray.buffer;\n  },\n  randomToken: function () {\n    return Math.random().toString(36).substr(2);\n  },\n  //\n\n  isSecure: function() {\n    return location.protocol === 'https:';\n  }\n};\n\nmodule.exports = util;\n\n},{\"./adapter\":1,\"js-binarypack\":10}],9:[function(require,module,exports){\n'use strict';\n\n/**\n * Representation of a single EventEmitter function.\n *\n * @param {Function} fn Event handler to be called.\n * @param {Mixed} context Context for function execution.\n * @param {Boolean} once Only emit once\n * @api private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Minimal EventEmitter interface that is molded against the Node.js\n * EventEmitter interface.\n *\n * @constructor\n * @api public\n */\nfunction EventEmitter() { /* Nothing to set */ }\n\n/**\n * Holds the assigned EventEmitters by name.\n *\n * @type {Object}\n * @private\n */\nEventEmitter.prototype._events = undefined;\n\n/**\n * Return a list of assigned event listeners.\n *\n * @param {String} event The events that should be listed.\n * @returns {Array}\n * @api public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  if (!this._events || !this._events[event]) return [];\n\n  for (var i = 0, l = this._events[event].length, ee = []; i < l; i++) {\n    ee.push(this._events[event][i].fn);\n  }\n\n  return ee;\n};\n\n/**\n * Emit an event to all registered event listeners.\n *\n * @param {String} event The name of the event.\n * @returns {Boolean} Indication if we've emitted an event.\n * @api public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  if (!this._events || !this._events[event]) return false;\n\n  var listeners = this._events[event]\n    , length = listeners.length\n    , len = arguments.length\n    , ee = listeners[0]\n    , args\n    , i, j;\n\n  if (1 === length) {\n    if (ee.once) this.removeListener(event, ee.fn, true);\n\n    switch (len) {\n      case 1: return ee.fn.call(ee.context), true;\n      case 2: return ee.fn.call(ee.context, a1), true;\n      case 3: return ee.fn.call(ee.context, a1, a2), true;\n      case 4: return ee.fn.call(ee.context, a1, a2, a3), true;\n      case 5: return ee.fn.call(ee.context, a1, a2, a3, a4), true;\n      case 6: return ee.fn.call(ee.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    ee.fn.apply(ee.context, args);\n  } else {\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Register a new EventListener for the given event.\n *\n * @param {String} event Name of the event.\n * @param {Functon} fn Callback function.\n * @param {Mixed} context The context of the function.\n * @api public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  if (!this._events) this._events = {};\n  if (!this._events[event]) this._events[event] = [];\n  this._events[event].push(new EE( fn, context || this ));\n\n  return this;\n};\n\n/**\n * Add an EventListener that's only called once.\n *\n * @param {String} event Name of the event.\n * @param {Function} fn Callback function.\n * @param {Mixed} context The context of the function.\n * @api public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  if (!this._events) this._events = {};\n  if (!this._events[event]) this._events[event] = [];\n  this._events[event].push(new EE(fn, context || this, true ));\n\n  return this;\n};\n\n/**\n * Remove event listeners.\n *\n * @param {String} event The event we want to remove.\n * @param {Function} fn The listener that we need to find.\n * @param {Boolean} once Only remove once listeners.\n * @api public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, once) {\n  if (!this._events || !this._events[event]) return this;\n\n  var listeners = this._events[event]\n    , events = [];\n\n  if (fn) for (var i = 0, length = listeners.length; i < length; i++) {\n    if (listeners[i].fn !== fn && listeners[i].once !== once) {\n      events.push(listeners[i]);\n    }\n  }\n\n  //\n  // Reset the array, or remove it completely if we have no more listeners.\n  //\n  if (events.length) this._events[event] = events;\n  else this._events[event] = null;\n\n  return this;\n};\n\n/**\n * Remove all listeners or only the listeners for the specified event.\n *\n * @param {String} event The event want to remove all listeners for.\n * @api public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  if (!this._events) return this;\n\n  if (event) this._events[event] = null;\n  else this._events = {};\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// This function doesn't apply anymore.\n//\nEventEmitter.prototype.setMaxListeners = function setMaxListeners() {\n  return this;\n};\n\n//\n// Expose the module.\n//\nEventEmitter.EventEmitter = EventEmitter;\nEventEmitter.EventEmitter2 = EventEmitter;\nEventEmitter.EventEmitter3 = EventEmitter;\n\nif ('object' === typeof module && module.exports) {\n  module.exports = EventEmitter;\n}\n\n},{}],10:[function(require,module,exports){\nvar BufferBuilder = require('./bufferbuilder').BufferBuilder;\nvar binaryFeatures = require('./bufferbuilder').binaryFeatures;\n\nvar BinaryPack = {\n  unpack: function(data){\n    var unpacker = new Unpacker(data);\n    return unpacker.unpack();\n  },\n  pack: function(data){\n    var packer = new Packer();\n    packer.pack(data);\n    var buffer = packer.getBuffer();\n    return buffer;\n  }\n};\n\nmodule.exports = BinaryPack;\n\nfunction Unpacker (data){\n  // Data is ArrayBuffer\n  this.index = 0;\n  this.dataBuffer = data;\n  this.dataView = new Uint8Array(this.dataBuffer);\n  this.length = this.dataBuffer.byteLength;\n}\n\nUnpacker.prototype.unpack = function(){\n  var type = this.unpack_uint8();\n  if (type < 0x80){\n    var positive_fixnum = type;\n    return positive_fixnum;\n  } else if ((type ^ 0xe0) < 0x20){\n    var negative_fixnum = (type ^ 0xe0) - 0x20;\n    return negative_fixnum;\n  }\n  var size;\n  if ((size = type ^ 0xa0) <= 0x0f){\n    return this.unpack_raw(size);\n  } else if ((size = type ^ 0xb0) <= 0x0f){\n    return this.unpack_string(size);\n  } else if ((size = type ^ 0x90) <= 0x0f){\n    return this.unpack_array(size);\n  } else if ((size = type ^ 0x80) <= 0x0f){\n    return this.unpack_map(size);\n  }\n  switch(type){\n    case 0xc0:\n      return null;\n    case 0xc1:\n      return undefined;\n    case 0xc2:\n      return false;\n    case 0xc3:\n      return true;\n    case 0xca:\n      return this.unpack_float();\n    case 0xcb:\n      return this.unpack_double();\n    case 0xcc:\n      return this.unpack_uint8();\n    case 0xcd:\n      return this.unpack_uint16();\n    case 0xce:\n      return this.unpack_uint32();\n    case 0xcf:\n      return this.unpack_uint64();\n    case 0xd0:\n      return this.unpack_int8();\n    case 0xd1:\n      return this.unpack_int16();\n    case 0xd2:\n      return this.unpack_int32();\n    case 0xd3:\n      return this.unpack_int64();\n    case 0xd4:\n      return undefined;\n    case 0xd5:\n      return undefined;\n    case 0xd6:\n      return undefined;\n    case 0xd7:\n      return undefined;\n    case 0xd8:\n      size = this.unpack_uint16();\n      return this.unpack_string(size);\n    case 0xd9:\n      size = this.unpack_uint32();\n      return this.unpack_string(size);\n    case 0xda:\n      size = this.unpack_uint16();\n      return this.unpack_raw(size);\n    case 0xdb:\n      size = this.unpack_uint32();\n      return this.unpack_raw(size);\n    case 0xdc:\n      size = this.unpack_uint16();\n      return this.unpack_array(size);\n    case 0xdd:\n      size = this.unpack_uint32();\n      return this.unpack_array(size);\n    case 0xde:\n      size = this.unpack_uint16();\n      return this.unpack_map(size);\n    case 0xdf:\n      size = this.unpack_uint32();\n      return this.unpack_map(size);\n  }\n}\n\nUnpacker.prototype.unpack_uint8 = function(){\n  var byte = this.dataView[this.index] & 0xff;\n  this.index++;\n  return byte;\n};\n\nUnpacker.prototype.unpack_uint16 = function(){\n  var bytes = this.read(2);\n  var uint16 =\n    ((bytes[0] & 0xff) * 256) + (bytes[1] & 0xff);\n  this.index += 2;\n  return uint16;\n}\n\nUnpacker.prototype.unpack_uint32 = function(){\n  var bytes = this.read(4);\n  var uint32 =\n     ((bytes[0]  * 256 +\n       bytes[1]) * 256 +\n       bytes[2]) * 256 +\n       bytes[3];\n  this.index += 4;\n  return uint32;\n}\n\nUnpacker.prototype.unpack_uint64 = function(){\n  var bytes = this.read(8);\n  var uint64 =\n   ((((((bytes[0]  * 256 +\n       bytes[1]) * 256 +\n       bytes[2]) * 256 +\n       bytes[3]) * 256 +\n       bytes[4]) * 256 +\n       bytes[5]) * 256 +\n       bytes[6]) * 256 +\n       bytes[7];\n  this.index += 8;\n  return uint64;\n}\n\n\nUnpacker.prototype.unpack_int8 = function(){\n  var uint8 = this.unpack_uint8();\n  return (uint8 < 0x80 ) ? uint8 : uint8 - (1 << 8);\n};\n\nUnpacker.prototype.unpack_int16 = function(){\n  var uint16 = this.unpack_uint16();\n  return (uint16 < 0x8000 ) ? uint16 : uint16 - (1 << 16);\n}\n\nUnpacker.prototype.unpack_int32 = function(){\n  var uint32 = this.unpack_uint32();\n  return (uint32 < Math.pow(2, 31) ) ? uint32 :\n    uint32 - Math.pow(2, 32);\n}\n\nUnpacker.prototype.unpack_int64 = function(){\n  var uint64 = this.unpack_uint64();\n  return (uint64 < Math.pow(2, 63) ) ? uint64 :\n    uint64 - Math.pow(2, 64);\n}\n\nUnpacker.prototype.unpack_raw = function(size){\n  if ( this.length < this.index + size){\n    throw new Error('BinaryPackFailure: index is out of range'\n      + ' ' + this.index + ' ' + size + ' ' + this.length);\n  }\n  var buf = this.dataBuffer.slice(this.index, this.index + size);\n  this.index += size;\n\n    //buf = util.bufferToString(buf);\n\n  return buf;\n}\n\nUnpacker.prototype.unpack_string = function(size){\n  var bytes = this.read(size);\n  var i = 0, str = '', c, code;\n  while(i < size){\n    c = bytes[i];\n    if ( c < 128){\n      str += String.fromCharCode(c);\n      i++;\n    } else if ((c ^ 0xc0) < 32){\n      code = ((c ^ 0xc0) << 6) | (bytes[i+1] & 63);\n      str += String.fromCharCode(code);\n      i += 2;\n    } else {\n      code = ((c & 15) << 12) | ((bytes[i+1] & 63) << 6) |\n        (bytes[i+2] & 63);\n      str += String.fromCharCode(code);\n      i += 3;\n    }\n  }\n  this.index += size;\n  return str;\n}\n\nUnpacker.prototype.unpack_array = function(size){\n  var objects = new Array(size);\n  for(var i = 0; i < size ; i++){\n    objects[i] = this.unpack();\n  }\n  return objects;\n}\n\nUnpacker.prototype.unpack_map = function(size){\n  var map = {};\n  for(var i = 0; i < size ; i++){\n    var key  = this.unpack();\n    var value = this.unpack();\n    map[key] = value;\n  }\n  return map;\n}\n\nUnpacker.prototype.unpack_float = function(){\n  var uint32 = this.unpack_uint32();\n  var sign = uint32 >> 31;\n  var exp  = ((uint32 >> 23) & 0xff) - 127;\n  var fraction = ( uint32 & 0x7fffff ) | 0x800000;\n  return (sign == 0 ? 1 : -1) *\n    fraction * Math.pow(2, exp - 23);\n}\n\nUnpacker.prototype.unpack_double = function(){\n  var h32 = this.unpack_uint32();\n  var l32 = this.unpack_uint32();\n  var sign = h32 >> 31;\n  var exp  = ((h32 >> 20) & 0x7ff) - 1023;\n  var hfrac = ( h32 & 0xfffff ) | 0x100000;\n  var frac = hfrac * Math.pow(2, exp - 20) +\n    l32   * Math.pow(2, exp - 52);\n  return (sign == 0 ? 1 : -1) * frac;\n}\n\nUnpacker.prototype.read = function(length){\n  var j = this.index;\n  if (j + length <= this.length) {\n    return this.dataView.subarray(j, j + length);\n  } else {\n    throw new Error('BinaryPackFailure: read index out of range');\n  }\n}\n\nfunction Packer(){\n  this.bufferBuilder = new BufferBuilder();\n}\n\nPacker.prototype.getBuffer = function(){\n  return this.bufferBuilder.getBuffer();\n}\n\nPacker.prototype.pack = function(value){\n  var type = typeof(value);\n  if (type == 'string'){\n    this.pack_string(value);\n  } else if (type == 'number'){\n    if (Math.floor(value) === value){\n      this.pack_integer(value);\n    } else{\n      this.pack_double(value);\n    }\n  } else if (type == 'boolean'){\n    if (value === true){\n      this.bufferBuilder.append(0xc3);\n    } else if (value === false){\n      this.bufferBuilder.append(0xc2);\n    }\n  } else if (type == 'undefined'){\n    this.bufferBuilder.append(0xc0);\n  } else if (type == 'object'){\n    if (value === null){\n      this.bufferBuilder.append(0xc0);\n    } else {\n      var constructor = value.constructor;\n      if (constructor == Array){\n        this.pack_array(value);\n      } else if (constructor == Blob || constructor == File) {\n        this.pack_bin(value);\n      } else if (constructor == ArrayBuffer) {\n        if(binaryFeatures.useArrayBufferView) {\n          this.pack_bin(new Uint8Array(value));\n        } else {\n          this.pack_bin(value);\n        }\n      } else if ('BYTES_PER_ELEMENT' in value){\n        if(binaryFeatures.useArrayBufferView) {\n          this.pack_bin(new Uint8Array(value.buffer));\n        } else {\n          this.pack_bin(value.buffer);\n        }\n      } else if (constructor == Object){\n        this.pack_object(value);\n      } else if (constructor == Date){\n        this.pack_string(value.toString());\n      } else if (typeof value.toBinaryPack == 'function'){\n        this.bufferBuilder.append(value.toBinaryPack());\n      } else {\n        throw new Error('Type \"' + constructor.toString() + '\" not yet supported');\n      }\n    }\n  } else {\n    throw new Error('Type \"' + type + '\" not yet supported');\n  }\n  this.bufferBuilder.flush();\n}\n\n\nPacker.prototype.pack_bin = function(blob){\n  var length = blob.length || blob.byteLength || blob.size;\n  if (length <= 0x0f){\n    this.pack_uint8(0xa0 + length);\n  } else if (length <= 0xffff){\n    this.bufferBuilder.append(0xda) ;\n    this.pack_uint16(length);\n  } else if (length <= 0xffffffff){\n    this.bufferBuilder.append(0xdb);\n    this.pack_uint32(length);\n  } else{\n    throw new Error('Invalid length');\n  }\n  this.bufferBuilder.append(blob);\n}\n\nPacker.prototype.pack_string = function(str){\n  var length = utf8Length(str);\n\n  if (length <= 0x0f){\n    this.pack_uint8(0xb0 + length);\n  } else if (length <= 0xffff){\n    this.bufferBuilder.append(0xd8) ;\n    this.pack_uint16(length);\n  } else if (length <= 0xffffffff){\n    this.bufferBuilder.append(0xd9);\n    this.pack_uint32(length);\n  } else{\n    throw new Error('Invalid length');\n  }\n  this.bufferBuilder.append(str);\n}\n\nPacker.prototype.pack_array = function(ary){\n  var length = ary.length;\n  if (length <= 0x0f){\n    this.pack_uint8(0x90 + length);\n  } else if (length <= 0xffff){\n    this.bufferBuilder.append(0xdc)\n    this.pack_uint16(length);\n  } else if (length <= 0xffffffff){\n    this.bufferBuilder.append(0xdd);\n    this.pack_uint32(length);\n  } else{\n    throw new Error('Invalid length');\n  }\n  for(var i = 0; i < length ; i++){\n    this.pack(ary[i]);\n  }\n}\n\nPacker.prototype.pack_integer = function(num){\n  if ( -0x20 <= num && num <= 0x7f){\n    this.bufferBuilder.append(num & 0xff);\n  } else if (0x00 <= num && num <= 0xff){\n    this.bufferBuilder.append(0xcc);\n    this.pack_uint8(num);\n  } else if (-0x80 <= num && num <= 0x7f){\n    this.bufferBuilder.append(0xd0);\n    this.pack_int8(num);\n  } else if ( 0x0000 <= num && num <= 0xffff){\n    this.bufferBuilder.append(0xcd);\n    this.pack_uint16(num);\n  } else if (-0x8000 <= num && num <= 0x7fff){\n    this.bufferBuilder.append(0xd1);\n    this.pack_int16(num);\n  } else if ( 0x00000000 <= num && num <= 0xffffffff){\n    this.bufferBuilder.append(0xce);\n    this.pack_uint32(num);\n  } else if (-0x80000000 <= num && num <= 0x7fffffff){\n    this.bufferBuilder.append(0xd2);\n    this.pack_int32(num);\n  } else if (-0x8000000000000000 <= num && num <= 0x7FFFFFFFFFFFFFFF){\n    this.bufferBuilder.append(0xd3);\n    this.pack_int64(num);\n  } else if (0x0000000000000000 <= num && num <= 0xFFFFFFFFFFFFFFFF){\n    this.bufferBuilder.append(0xcf);\n    this.pack_uint64(num);\n  } else{\n    throw new Error('Invalid integer');\n  }\n}\n\nPacker.prototype.pack_double = function(num){\n  var sign = 0;\n  if (num < 0){\n    sign = 1;\n    num = -num;\n  }\n  var exp  = Math.floor(Math.log(num) / Math.LN2);\n  var frac0 = num / Math.pow(2, exp) - 1;\n  var frac1 = Math.floor(frac0 * Math.pow(2, 52));\n  var b32   = Math.pow(2, 32);\n  var h32 = (sign << 31) | ((exp+1023) << 20) |\n      (frac1 / b32) & 0x0fffff;\n  var l32 = frac1 % b32;\n  this.bufferBuilder.append(0xcb);\n  this.pack_int32(h32);\n  this.pack_int32(l32);\n}\n\nPacker.prototype.pack_object = function(obj){\n  var keys = Object.keys(obj);\n  var length = keys.length;\n  if (length <= 0x0f){\n    this.pack_uint8(0x80 + length);\n  } else if (length <= 0xffff){\n    this.bufferBuilder.append(0xde);\n    this.pack_uint16(length);\n  } else if (length <= 0xffffffff){\n    this.bufferBuilder.append(0xdf);\n    this.pack_uint32(length);\n  } else{\n    throw new Error('Invalid length');\n  }\n  for(var prop in obj){\n    if (obj.hasOwnProperty(prop)){\n      this.pack(prop);\n      this.pack(obj[prop]);\n    }\n  }\n}\n\nPacker.prototype.pack_uint8 = function(num){\n  this.bufferBuilder.append(num);\n}\n\nPacker.prototype.pack_uint16 = function(num){\n  this.bufferBuilder.append(num >> 8);\n  this.bufferBuilder.append(num & 0xff);\n}\n\nPacker.prototype.pack_uint32 = function(num){\n  var n = num & 0xffffffff;\n  this.bufferBuilder.append((n & 0xff000000) >>> 24);\n  this.bufferBuilder.append((n & 0x00ff0000) >>> 16);\n  this.bufferBuilder.append((n & 0x0000ff00) >>>  8);\n  this.bufferBuilder.append((n & 0x000000ff));\n}\n\nPacker.prototype.pack_uint64 = function(num){\n  var high = num / Math.pow(2, 32);\n  var low  = num % Math.pow(2, 32);\n  this.bufferBuilder.append((high & 0xff000000) >>> 24);\n  this.bufferBuilder.append((high & 0x00ff0000) >>> 16);\n  this.bufferBuilder.append((high & 0x0000ff00) >>>  8);\n  this.bufferBuilder.append((high & 0x000000ff));\n  this.bufferBuilder.append((low  & 0xff000000) >>> 24);\n  this.bufferBuilder.append((low  & 0x00ff0000) >>> 16);\n  this.bufferBuilder.append((low  & 0x0000ff00) >>>  8);\n  this.bufferBuilder.append((low  & 0x000000ff));\n}\n\nPacker.prototype.pack_int8 = function(num){\n  this.bufferBuilder.append(num & 0xff);\n}\n\nPacker.prototype.pack_int16 = function(num){\n  this.bufferBuilder.append((num & 0xff00) >> 8);\n  this.bufferBuilder.append(num & 0xff);\n}\n\nPacker.prototype.pack_int32 = function(num){\n  this.bufferBuilder.append((num >>> 24) & 0xff);\n  this.bufferBuilder.append((num & 0x00ff0000) >>> 16);\n  this.bufferBuilder.append((num & 0x0000ff00) >>> 8);\n  this.bufferBuilder.append((num & 0x000000ff));\n}\n\nPacker.prototype.pack_int64 = function(num){\n  var high = Math.floor(num / Math.pow(2, 32));\n  var low  = num % Math.pow(2, 32);\n  this.bufferBuilder.append((high & 0xff000000) >>> 24);\n  this.bufferBuilder.append((high & 0x00ff0000) >>> 16);\n  this.bufferBuilder.append((high & 0x0000ff00) >>>  8);\n  this.bufferBuilder.append((high & 0x000000ff));\n  this.bufferBuilder.append((low  & 0xff000000) >>> 24);\n  this.bufferBuilder.append((low  & 0x00ff0000) >>> 16);\n  this.bufferBuilder.append((low  & 0x0000ff00) >>>  8);\n  this.bufferBuilder.append((low  & 0x000000ff));\n}\n\nfunction _utf8Replace(m){\n  var code = m.charCodeAt(0);\n\n  if(code <= 0x7ff) return '00';\n  if(code <= 0xffff) return '000';\n  if(code <= 0x1fffff) return '0000';\n  if(code <= 0x3ffffff) return '00000';\n  return '000000';\n}\n\nfunction utf8Length(str){\n  if (str.length > 600) {\n    // Blob method faster for large strings\n    return (new Blob([str])).size;\n  } else {\n    return str.replace(/[^\\u0000-\\u007F]/g, _utf8Replace).length;\n  }\n}\n\n},{\"./bufferbuilder\":11}],11:[function(require,module,exports){\nvar binaryFeatures = {};\nbinaryFeatures.useBlobBuilder = (function(){\n  try {\n    new Blob([]);\n    return false;\n  } catch (e) {\n    return true;\n  }\n})();\n\nbinaryFeatures.useArrayBufferView = !binaryFeatures.useBlobBuilder && (function(){\n  try {\n    return (new Blob([new Uint8Array([])])).size === 0;\n  } catch (e) {\n    return true;\n  }\n})();\n\nmodule.exports.binaryFeatures = binaryFeatures;\nvar BlobBuilder = module.exports.BlobBuilder;\nif (typeof window != 'undefined') {\n  BlobBuilder = module.exports.BlobBuilder = window.WebKitBlobBuilder ||\n    window.MozBlobBuilder || window.MSBlobBuilder || window.BlobBuilder;\n}\n\nfunction BufferBuilder(){\n  this._pieces = [];\n  this._parts = [];\n}\n\nBufferBuilder.prototype.append = function(data) {\n  if(typeof data === 'number') {\n    this._pieces.push(data);\n  } else {\n    this.flush();\n    this._parts.push(data);\n  }\n};\n\nBufferBuilder.prototype.flush = function() {\n  if (this._pieces.length > 0) {\n    var buf = new Uint8Array(this._pieces);\n    if(!binaryFeatures.useArrayBufferView) {\n      buf = buf.buffer;\n    }\n    this._parts.push(buf);\n    this._pieces = [];\n  }\n};\n\nBufferBuilder.prototype.getBuffer = function() {\n  this.flush();\n  if(binaryFeatures.useBlobBuilder) {\n    var builder = new BlobBuilder();\n    for(var i = 0, ii = this._parts.length; i < ii; i++) {\n      builder.append(this._parts[i]);\n    }\n    return builder.getBlob();\n  } else {\n    return new Blob(this._parts);\n  }\n};\n\nmodule.exports.BufferBuilder = BufferBuilder;\n\n},{}],12:[function(require,module,exports){\nvar util = require('./util');\n\n/**\n * Reliable transfer for Chrome Canary DataChannel impl.\n * Author: @michellebu\n */\nfunction Reliable(dc, debug) {\n  if (!(this instanceof Reliable)) return new Reliable(dc);\n  this._dc = dc;\n\n  util.debug = debug;\n\n  // Messages sent/received so far.\n  // id: { ack: n, chunks: [...] }\n  this._outgoing = {};\n  // id: { ack: ['ack', id, n], chunks: [...] }\n  this._incoming = {};\n  this._received = {};\n\n  // Window size.\n  this._window = 1000;\n  // MTU.\n  this._mtu = 500;\n  // Interval for setInterval. In ms.\n  this._interval = 0;\n\n  // Messages sent.\n  this._count = 0;\n\n  // Outgoing message queue.\n  this._queue = [];\n\n  this._setupDC();\n};\n\n// Send a message reliably.\nReliable.prototype.send = function(msg) {\n  // Determine if chunking is necessary.\n  var bl = util.pack(msg);\n  if (bl.size < this._mtu) {\n    this._handleSend(['no', bl]);\n    return;\n  }\n\n  this._outgoing[this._count] = {\n    ack: 0,\n    chunks: this._chunk(bl)\n  };\n\n  if (util.debug) {\n    this._outgoing[this._count].timer = new Date();\n  }\n\n  // Send prelim window.\n  this._sendWindowedChunks(this._count);\n  this._count += 1;\n};\n\n// Set up interval for processing queue.\nReliable.prototype._setupInterval = function() {\n  // TODO: fail gracefully.\n\n  var self = this;\n  this._timeout = setInterval(function() {\n    // FIXME: String stuff makes things terribly async.\n    var msg = self._queue.shift();\n    if (msg._multiple) {\n      for (var i = 0, ii = msg.length; i < ii; i += 1) {\n        self._intervalSend(msg[i]);\n      }\n    } else {\n      self._intervalSend(msg);\n    }\n  }, this._interval);\n};\n\nReliable.prototype._intervalSend = function(msg) {\n  var self = this;\n  msg = util.pack(msg);\n  util.blobToBinaryString(msg, function(str) {\n    self._dc.send(str);\n  });\n  if (self._queue.length === 0) {\n    clearTimeout(self._timeout);\n    self._timeout = null;\n    //self._processAcks();\n  }\n};\n\n// Go through ACKs to send missing pieces.\nReliable.prototype._processAcks = function() {\n  for (var id in this._outgoing) {\n    if (this._outgoing.hasOwnProperty(id)) {\n      this._sendWindowedChunks(id);\n    }\n  }\n};\n\n// Handle sending a message.\n// FIXME: Don't wait for interval time for all messages...\nReliable.prototype._handleSend = function(msg) {\n  var push = true;\n  for (var i = 0, ii = this._queue.length; i < ii; i += 1) {\n    var item = this._queue[i];\n    if (item === msg) {\n      push = false;\n    } else if (item._multiple && item.indexOf(msg) !== -1) {\n      push = false;\n    }\n  }\n  if (push) {\n    this._queue.push(msg);\n    if (!this._timeout) {\n      this._setupInterval();\n    }\n  }\n};\n\n// Set up DataChannel handlers.\nReliable.prototype._setupDC = function() {\n  // Handle various message types.\n  var self = this;\n  this._dc.onmessage = function(e) {\n    var msg = e.data;\n    var datatype = msg.constructor;\n    // FIXME: msg is String until binary is supported.\n    // Once that happens, this will have to be smarter.\n    if (datatype === String) {\n      var ab = util.binaryStringToArrayBuffer(msg);\n      msg = util.unpack(ab);\n      self._handleMessage(msg);\n    }\n  };\n};\n\n// Handles an incoming message.\nReliable.prototype._handleMessage = function(msg) {\n  var id = msg[1];\n  var idata = this._incoming[id];\n  var odata = this._outgoing[id];\n  var data;\n  switch (msg[0]) {\n    // No chunking was done.\n    case 'no':\n      var message = id;\n      if (!!message) {\n        this.onmessage(util.unpack(message));\n      }\n      break;\n    // Reached the end of the message.\n    case 'end':\n      data = idata;\n\n      // In case end comes first.\n      this._received[id] = msg[2];\n\n      if (!data) {\n        break;\n      }\n\n      this._ack(id);\n      break;\n    case 'ack':\n      data = odata;\n      if (!!data) {\n        var ack = msg[2];\n        // Take the larger ACK, for out of order messages.\n        data.ack = Math.max(ack, data.ack);\n\n        // Clean up when all chunks are ACKed.\n        if (data.ack >= data.chunks.length) {\n          util.log('Time: ', new Date() - data.timer);\n          delete this._outgoing[id];\n        } else {\n          this._processAcks();\n        }\n      }\n      // If !data, just ignore.\n      break;\n    // Received a chunk of data.\n    case 'chunk':\n      // Create a new entry if none exists.\n      data = idata;\n      if (!data) {\n        var end = this._received[id];\n        if (end === true) {\n          break;\n        }\n        data = {\n          ack: ['ack', id, 0],\n          chunks: []\n        };\n        this._incoming[id] = data;\n      }\n\n      var n = msg[2];\n      var chunk = msg[3];\n      data.chunks[n] = new Uint8Array(chunk);\n\n      // If we get the chunk we're looking for, ACK for next missing.\n      // Otherwise, ACK the same N again.\n      if (n === data.ack[2]) {\n        this._calculateNextAck(id);\n      }\n      this._ack(id);\n      break;\n    default:\n      // Shouldn't happen, but would make sense for message to just go\n      // through as is.\n      this._handleSend(msg);\n      break;\n  }\n};\n\n// Chunks BL into smaller messages.\nReliable.prototype._chunk = function(bl) {\n  var chunks = [];\n  var size = bl.size;\n  var start = 0;\n  while (start < size) {\n    var end = Math.min(size, start + this._mtu);\n    var b = bl.slice(start, end);\n    var chunk = {\n      payload: b\n    }\n    chunks.push(chunk);\n    start = end;\n  }\n  util.log('Created', chunks.length, 'chunks.');\n  return chunks;\n};\n\n// Sends ACK N, expecting Nth blob chunk for message ID.\nReliable.prototype._ack = function(id) {\n  var ack = this._incoming[id].ack;\n\n  // if ack is the end value, then call _complete.\n  if (this._received[id] === ack[2]) {\n    this._complete(id);\n    this._received[id] = true;\n  }\n\n  this._handleSend(ack);\n};\n\n// Calculates the next ACK number, given chunks.\nReliable.prototype._calculateNextAck = function(id) {\n  var data = this._incoming[id];\n  var chunks = data.chunks;\n  for (var i = 0, ii = chunks.length; i < ii; i += 1) {\n    // This chunk is missing!!! Better ACK for it.\n    if (chunks[i] === undefined) {\n      data.ack[2] = i;\n      return;\n    }\n  }\n  data.ack[2] = chunks.length;\n};\n\n// Sends the next window of chunks.\nReliable.prototype._sendWindowedChunks = function(id) {\n  util.log('sendWindowedChunks for: ', id);\n  var data = this._outgoing[id];\n  var ch = data.chunks;\n  var chunks = [];\n  var limit = Math.min(data.ack + this._window, ch.length);\n  for (var i = data.ack; i < limit; i += 1) {\n    if (!ch[i].sent || i === data.ack) {\n      ch[i].sent = true;\n      chunks.push(['chunk', id, i, ch[i].payload]);\n    }\n  }\n  if (data.ack + this._window >= ch.length) {\n    chunks.push(['end', id, ch.length])\n  }\n  chunks._multiple = true;\n  this._handleSend(chunks);\n};\n\n// Puts together a message from chunks.\nReliable.prototype._complete = function(id) {\n  util.log('Completed called for', id);\n  var self = this;\n  var chunks = this._incoming[id].chunks;\n  var bl = new Blob(chunks);\n  util.blobToArrayBuffer(bl, function(ab) {\n    self.onmessage(util.unpack(ab));\n  });\n  delete this._incoming[id];\n};\n\n// Ups bandwidth limit on SDP. Meant to be called during offer/answer.\nReliable.higherBandwidthSDP = function(sdp) {\n  // AS stands for Application-Specific Maximum.\n  // Bandwidth number is in kilobits / sec.\n  // See RFC for more info: http://www.ietf.org/rfc/rfc2327.txt\n\n  // Chrome 31+ doesn't want us munging the SDP, so we'll let them have their\n  // way.\n  var version = navigator.appVersion.match(/Chrome\\/(.*?) /);\n  if (version) {\n    version = parseInt(version[1].split('.').shift());\n    if (version < 31) {\n      var parts = sdp.split('b=AS:30');\n      var replace = 'b=AS:102400'; // 100 Mbps\n      if (parts.length > 1) {\n        return parts[0] + replace + parts[1];\n      }\n    }\n  }\n\n  return sdp;\n};\n\n// Overwritten, typically.\nReliable.prototype.onmessage = function(msg) {};\n\nmodule.exports.Reliable = Reliable;\n\n},{\"./util\":13}],13:[function(require,module,exports){\nvar BinaryPack = require('js-binarypack');\n\nvar util = {\n  debug: false,\n  \n  inherits: function(ctor, superCtor) {\n    ctor.super_ = superCtor;\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  },\n  extend: function(dest, source) {\n    for(var key in source) {\n      if(source.hasOwnProperty(key)) {\n        dest[key] = source[key];\n      }\n    }\n    return dest;\n  },\n  pack: BinaryPack.pack,\n  unpack: BinaryPack.unpack,\n  \n  log: function () {\n    if (util.debug) {\n      var copy = [];\n      for (var i = 0; i < arguments.length; i++) {\n        copy[i] = arguments[i];\n      }\n      copy.unshift('Reliable: ');\n      console.log.apply(console, copy);\n    }\n  },\n\n  setZeroTimeout: (function(global) {\n    var timeouts = [];\n    var messageName = 'zero-timeout-message';\n\n    // Like setTimeout, but only takes a function argument.\t There's\n    // no time argument (always zero) and no arguments (you have to\n    // use a closure).\n    function setZeroTimeoutPostMessage(fn) {\n      timeouts.push(fn);\n      global.postMessage(messageName, '*');\n    }\t\t\n\n    function handleMessage(event) {\n      if (event.source == global && event.data == messageName) {\n        if (event.stopPropagation) {\n          event.stopPropagation();\n        }\n        if (timeouts.length) {\n          timeouts.shift()();\n        }\n      }\n    }\n    if (global.addEventListener) {\n      global.addEventListener('message', handleMessage, true);\n    } else if (global.attachEvent) {\n      global.attachEvent('onmessage', handleMessage);\n    }\n    return setZeroTimeoutPostMessage;\n  }(this)),\n  \n  blobToArrayBuffer: function(blob, cb){\n    var fr = new FileReader();\n    fr.onload = function(evt) {\n      cb(evt.target.result);\n    };\n    fr.readAsArrayBuffer(blob);\n  },\n  blobToBinaryString: function(blob, cb){\n    var fr = new FileReader();\n    fr.onload = function(evt) {\n      cb(evt.target.result);\n    };\n    fr.readAsBinaryString(blob);\n  },\n  binaryStringToArrayBuffer: function(binary) {\n    var byteArray = new Uint8Array(binary.length);\n    for (var i = 0; i < binary.length; i++) {\n      byteArray[i] = binary.charCodeAt(i) & 0xff;\n    }\n    return byteArray.buffer;\n  },\n  randomToken: function () {\n    return Math.random().toString(36).substr(2);\n  }\n};\n\nmodule.exports = util;\n\n},{\"js-binarypack\":10}]},{},[3]);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./client/libs/peer.js\n// module id = 83\n// module chunks = 6"],"sourceRoot":""}